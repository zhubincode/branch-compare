<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÂàÜÊîØÂØπÊØî: main vs feature/test</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
    <style>
      /**
 * Neumorphism Design Tokens
 * Cool Grey Monochromatic Palette with RGBA Shadows
 */

@import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&family=DM+Sans:wght@400;500;700&display=swap");

:root {
  /* ========== Colors - Cool Grey Monochromatic ========== */

  /* Base "Cool Clay" Surface */
  --color-bg: #e0e5ec;

  /* Text Colors - WCAG Compliant */
  --color-fg: #3d4852; /* Primary text - 7.5:1 contrast (AAA) */
  --color-muted: #6b7280; /* Secondary text - 4.6:1 contrast (AA) */

  /* Accent Colors */
  --color-accent: #6c63ff; /* Soft violet for CTAs */
  --color-accent-light: #8b84ff; /* Lighter violet for hover */
  --color-accent-secondary: #38b2ac; /* Teal for success */

  /* Semantic Colors */
  --color-success: #28a745;
  --color-warning: #ff9800;
  --color-danger: #dc3545;
  --color-info: #1890ff;

  /* ========== Shadows - RGBA for Premium Smoothness ========== */

  /* Shadow Colors */
  --shadow-light: rgba(255, 255, 255, 0.5);
  --shadow-light-strong: rgba(255, 255, 255, 0.6);
  --shadow-dark: rgba(163, 177, 198, 0.6);
  --shadow-dark-strong: rgba(163, 177, 198, 0.7);

  /* Extruded (Raised) - Default State */
  --shadow-extruded: 9px 9px 16px var(--shadow-dark),
    -9px -9px 16px var(--shadow-light);

  /* Extruded Hover - Lifted State */
  --shadow-extruded-hover: 12px 12px 20px var(--shadow-dark-strong),
    -12px -12px 20px var(--shadow-light-strong);

  /* Extruded Small - For Smaller Elements */
  --shadow-extruded-small: 5px 5px 10px var(--shadow-dark),
    -5px -5px 10px var(--shadow-light);

  /* Inset (Pressed) - Standard Pressed State */
  --shadow-inset: inset 6px 6px 10px var(--shadow-dark),
    inset -6px -6px 10px var(--shadow-light);

  /* Inset Deep - For Inputs and Deep Wells */
  --shadow-inset-deep: inset 10px 10px 20px var(--shadow-dark-strong),
    inset -10px -10px 20px var(--shadow-light-strong);

  /* Inset Small - For Subtle Tracks */
  --shadow-inset-small: inset 3px 3px 6px var(--shadow-dark),
    inset -3px -3px 6px var(--shadow-light);

  /* ========== Border Radius - Soft & Rounded ========== */

  --radius-container: 32px; /* Cards and major containers */
  --radius-base: 16px; /* Buttons and medium elements */
  --radius-small: 12px; /* Inner elements */
  --radius-full: 9999px; /* Pills and circles */

  /* ========== Typography ========== */

  --font-display: "Plus Jakarta Sans", sans-serif;
  --font-body: "DM Sans", sans-serif;
  --font-mono: "SF Mono", "Monaco", "Inconsolata", "Fira Code", monospace;

  /* Font Weights */
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --font-weight-extrabold: 800;

  /* Font Sizes - Âπ≥Ë°°ÁöÑÂ∞∫ÂØ∏ */
  --font-size-xs: 0.75rem; /* 12px */
  --font-size-sm: 0.875rem; /* 14px */
  --font-size-base: 0.9375rem; /* 15px */
  --font-size-lg: 1.0625rem; /* 17px */
  --font-size-xl: 1.25rem; /* 20px */
  --font-size-2xl: 1.5rem; /* 24px */
  --font-size-3xl: 1.875rem; /* 30px */
  --font-size-4xl: 2.25rem; /* 36px */
  --font-size-5xl: 2.75rem; /* 44px */
  --font-size-7xl: 3.5rem; /* 56px */

  /* Line Heights */
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;

  /* ========== Spacing ========== */

  --spacing-1: 0.25rem; /* 4px */
  --spacing-2: 0.5rem; /* 8px */
  --spacing-3: 0.75rem; /* 12px */
  --spacing-4: 1rem; /* 16px */
  --spacing-5: 1.25rem; /* 20px */
  --spacing-6: 1.5rem; /* 24px */
  --spacing-8: 2rem; /* 32px */
  --spacing-10: 2.5rem; /* 40px */
  --spacing-12: 3rem; /* 48px */
  --spacing-16: 4rem; /* 64px */
  --spacing-20: 5rem; /* 80px */
  --spacing-32: 8rem; /* 128px */

  /* ========== Transitions ========== */

  --transition-fast: 150ms ease-out;
  --transition-base: 300ms ease-out;
  --transition-slow: 500ms ease-out;

  /* ========== Z-Index ========== */

  --z-base: 1;
  --z-dropdown: 10;
  --z-sticky: 20;
  --z-fixed: 30;
  --z-modal-backdrop: 40;
  --z-modal: 50;
  --z-tooltip: 60;

  /* ========== Breakpoints (for reference) ========== */

  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
}

/**
 * Base Styles - Global Resets and Typography
 * Neumorphism Design System
 */

/* ========== Global Reset ========== */

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-body);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-normal);
  line-height: var(--line-height-normal);
  color: var(--color-fg);
  background: var(--color-bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding: var(--spacing-2);
  min-height: 100vh;
}

/* ========== Typography ========== */

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-display);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  color: var(--color-fg);
  margin-bottom: var(--spacing-3);
}

h1 {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-extrabold);
}

h2 {
  font-size: var(--font-size-3xl);
}

h3 {
  font-size: var(--font-size-2xl);
}

p {
  margin-bottom: var(--spacing-4);
}

/* ========== Links ========== */

a {
  color: var(--color-accent);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--color-accent-light);
}

a:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  border-radius: var(--radius-small);
}

/* ========== Buttons Reset ========== */

button {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  cursor: pointer;
  border: none;
  background: none;
}

button:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* ========== Inputs Reset ========== */

input,
textarea,
select {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  color: inherit;
}

input:focus,
textarea:focus,
select:focus {
  outline: none;
}

/* ========== Accessibility ========== */

/* Focus visible for keyboard navigation */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* Skip to content link */
.skip-to-content {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--color-accent);
  color: white;
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-base);
  z-index: var(--z-tooltip);
}

.skip-to-content:focus {
  top: var(--spacing-2);
}

/* Screen reader only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* ========== Scrollbar Styling ========== */

::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--color-bg);
  border-radius: var(--radius-small);
  box-shadow: var(--shadow-inset-small);
}

::-webkit-scrollbar-thumb {
  background: var(--color-muted);
  border-radius: var(--radius-small);
  box-shadow: var(--shadow-extruded-small);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-fg);
}

/* ========== Selection ========== */

::selection {
  background: var(--color-accent);
  color: white;
}

::-moz-selection {
  background: var(--color-accent);
  color: white;
}

/**
 * Layout Styles Â∏ÉÂ±ÄÊ†∑Âºè
 * Neumorphism Design System - Layout Components
 */

/* ========== Container ÂÆπÂô® ========== */

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: var(--color-bg);
  border-radius: var(--radius-container);
  box-shadow: var(--shadow-extruded);
  padding: var(--spacing-3);
}

/* ========== Header Â§¥ÈÉ® ========== */

.header {
  margin-bottom: var(--spacing-3);
  padding-bottom: var(--spacing-2);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: var(--spacing-3);
  border-bottom: 1px solid rgba(163, 177, 198, 0.15);
}

.header h1 {
  margin: 0 0 var(--spacing-2) 0;
  color: var(--color-fg);
  font-family: var(--font-display);
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-extrabold);
  letter-spacing: -0.02em;
}

.meta-info {
  color: var(--color-muted);
  font-size: var(--font-size-sm);
  line-height: 1.6;
}

.meta-info > div {
  margin-bottom: var(--spacing-2);
}

/* ========== Legend Âõæ‰æã ========== */

.timeline-legend {
  display: flex;
  justify-content: flex-start;
  flex-wrap: wrap;
  gap: var(--spacing-4);
  margin-top: var(--spacing-4);
}

.legend-item {
  display: inline-flex;
  align-items: center;
  background: var(--color-bg);
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-extruded-small);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-fg);
  transition: all var(--transition-base);
  min-height: 36px;
}

.legend-item:hover {
  transform: translateY(-2px);
  box-shadow: 8px 8px 16px rgba(163, 177, 198, 0.5),
    -8px -8px 16px rgba(255, 255, 255, 0.8);
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: var(--spacing-2);
  display: inline-block;
  box-shadow: inset 2px 2px 4px rgba(163, 177, 198, 0.3),
    inset -2px -2px 4px rgba(255, 255, 255, 0.5);
}

.legend-dot.source {
  background-color: var(--color-success);
}

.legend-dot.target {
  background-color: var(--color-warning);
}

.legend-dot.both {
  background-color: var(--color-info);
}

/* ========== Theme Switcher ‰∏ªÈ¢òÂàáÊç¢Âô® ========== */

.theme-switcher {
  display: flex;
  align-items: center;
  background: var(--color-bg);
  border-radius: var(--radius-full);
  padding: var(--spacing-1);
  box-shadow: var(--shadow-inset);
  gap: var(--spacing-1);
}

.theme-button {
  border: none;
  background: transparent;
  color: var(--color-muted);
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-full);
  cursor: pointer;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  display: flex;
  align-items: center;
  gap: var(--spacing-2);
  transition: all var(--transition-base);
  min-height: 36px;
  white-space: nowrap;
}

.theme-button:hover:not(.active) {
  color: var(--color-fg);
}

.theme-button.active {
  background: var(--color-accent);
  color: white;
  box-shadow: var(--shadow-extruded-small);
}

.theme-button .layout-icon {
  font-size: var(--font-size-base);
}

/* ========== Timeline Êó∂Èó¥Á∫ø ========== */

.timeline {
  position: relative;
  display: flex;
  flex-direction: column;
  padding: var(--spacing-2) 0;
  width: 100%;
}

.commit-row {
  display: flex;
  margin-bottom: var(--spacing-2);
  position: relative;
  width: 100%;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== Commit Container Êèê‰∫§ÂÆπÂô® ========== */

.commit-container {
  max-width: 75%;
  width: 75%;
  position: relative;
}

.commit-container.source {
  align-self: flex-start;
  margin-right: auto;
}

.commit-container.target {
  align-self: flex-end;
  margin-left: auto;
}

.commit-container.both {
  align-self: center;
  max-width: 90%;
  width: 90%;
  margin: 0 auto;
}

/* ========== Flat Layout Âπ≥Èì∫Â∏ÉÂ±Ä ========== */

body[data-layout="flat"] .timeline .commit-row {
  justify-content: center;
}

body[data-layout="flat"] .timeline .commit-container {
  max-width: 100%;
  width: 100%;
  margin: 0 auto;
  align-self: center;
}

body[data-layout="flat"] .timeline .commit-container.both {
  max-width: 100%;
}

/* ========== Filter Section Á≠õÈÄâÂå∫Âüü ========== */

.filter-section {
  margin-bottom: var(--spacing-3);
  padding: var(--spacing-3);
  background: var(--color-bg);
  border-radius: var(--radius-container);
  box-shadow: var(--shadow-inset);
}

.filter-buttons {
  display: flex;
  gap: var(--spacing-3);
  margin-bottom: var(--spacing-5);
  flex-wrap: wrap;
}

.sub-filter-section {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-4);
  margin: var(--spacing-4) 0 0 0;
  padding: var(--spacing-4);
  background: rgba(163, 177, 198, 0.05);
  border-radius: var(--radius-base);
  transition: all var(--transition-base);
  max-height: 200px;
  overflow: hidden;
}

.sub-filter-section.hidden {
  max-height: 0;
  margin: 0;
  padding: 0;
  opacity: 0;
}

/* ========== Search Section ÊêúÁ¥¢Âå∫Âüü ========== */

.search-section {
  margin-top: var(--spacing-5);
  padding: var(--spacing-4);
  background: rgba(163, 177, 198, 0.05);
  border-radius: var(--radius-base);
}

.search-container {
  position: relative;
  width: 100%;
  display: flex;
  align-items: center;
  margin-bottom: var(--spacing-4);
  gap: var(--spacing-3);
  flex-wrap: nowrap;
}

.search-input {
  flex: 0 0 300px;
  max-width: 300px;
}

.clear-search {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  min-width: 32px;
  min-height: 32px;
  border-radius: 50%;
  background: var(--color-bg);
  color: var(--color-muted);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  box-shadow: var(--shadow-extruded-small);
  transition: all var(--transition-base);
}

.clear-search:hover {
  color: var(--color-danger);
  transform: scale(1.05);
  box-shadow: var(--shadow-extruded-hover);
}

.clear-search:active {
  transform: scale(0.95);
  box-shadow: var(--shadow-inset-small);
}

.search-options {
  display: flex;
  flex-wrap: nowrap;
  gap: var(--spacing-4);
  align-items: center;
  white-space: nowrap;
}

/* ========== Command Section ÂëΩ‰ª§Âå∫Âüü ========== */

.command-section {
  margin-top: var(--spacing-3);
  background: var(--color-bg);
  padding: var(--spacing-3);
  border-radius: var(--radius-container);
  box-shadow: var(--shadow-inset);
}

.command-section h3 {
  margin: 0 0 var(--spacing-2) 0;
  color: var(--color-fg);
  font-family: var(--font-display);
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-3);
  flex-wrap: nowrap;
}

.command-section h3 > span:first-child {
  white-space: nowrap;
}

.copy-button {
  flex-shrink: 0;
  white-space: nowrap;
}

.command-tabs {
  display: flex;
  gap: var(--spacing-2);
  margin-bottom: var(--spacing-3);
  background: var(--color-bg);
  padding: var(--spacing-1);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-inset);
}

.command-content {
  display: none;
}

.command-content.active {
  display: block;
}

.command-line {
  display: flex;
  align-items: center;
  margin: var(--spacing-2) 0;
  gap: var(--spacing-3);
  padding: var(--spacing-3) var(--spacing-4);
  background: linear-gradient(
    135deg,
    rgba(40, 44, 52, 0.98) 0%,
    rgba(33, 37, 43, 0.98) 100%
  );
  border-radius: var(--radius-base);
  border-left: 3px solid var(--color-accent);
  box-shadow: inset 2px 2px 4px rgba(0, 0, 0, 0.3),
    inset -1px -1px 2px rgba(255, 255, 255, 0.05), 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all var(--transition-fast);
}

.command-line:hover {
  border-left-color: var(--color-accent-light);
  box-shadow: inset 2px 2px 4px rgba(0, 0, 0, 0.3),
    inset -1px -1px 2px rgba(255, 255, 255, 0.05),
    0 4px 12px rgba(108, 99, 255, 0.15);
}

.command-line pre {
  margin: 0;
  flex-grow: 1;
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  white-space: pre-wrap;
  overflow-x: auto;
  color: #abb2bf;
  line-height: 1.6;
  font-weight: var(--font-weight-medium);
}

.command-line pre code {
  color: #61afef;
  text-shadow: 0 0 8px rgba(97, 175, 239, 0.3);
}

#source-to-target-commands-container,
#target-to-source-commands-container {
  max-height: 400px;
  overflow-y: auto;
  padding: var(--spacing-3);
  background: rgba(163, 177, 198, 0.03);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-inset-small);
}

/* ========== Responsive Design ÂìçÂ∫îÂºèËÆæËÆ° ========== */

@media (max-width: 1024px) {
  .container {
    padding: var(--spacing-6);
  }

  .commit-container {
    max-width: 85%;
  }

  body[data-layout="flat"] .timeline .commit-container {
    max-width: 100%;
  }
}

@media (max-width: 768px) {
  body {
    padding: var(--spacing-3);
  }

  .container {
    padding: var(--spacing-5);
    border-radius: var(--radius-base);
  }

  .header {
    flex-direction: column;
    gap: var(--spacing-5);
    padding-bottom: var(--spacing-5);
  }

  .header h1 {
    font-size: var(--font-size-2xl);
  }

  .timeline-legend {
    gap: var(--spacing-3);
    justify-content: flex-start;
  }

  .legend-item {
    font-size: var(--font-size-xs);
    padding: var(--spacing-2) var(--spacing-3);
  }

  .theme-switcher {
    width: 100%;
  }

  .theme-button {
    flex: 1;
    justify-content: center;
    padding: var(--spacing-3) var(--spacing-4);
  }

  .timeline {
    padding: var(--spacing-4) 0;
  }

  .commit-container,
  .commit-container.source,
  .commit-container.target,
  .commit-container.both {
    max-width: 100%;
  }

  body[data-layout="flat"] .timeline .commit-container {
    max-width: 100%;
  }

  .filter-section {
    padding: var(--spacing-5);
  }

  .filter-buttons {
    gap: var(--spacing-2);
  }

  .search-container {
    flex-direction: column;
    align-items: stretch;
    gap: var(--spacing-3);
  }

  .search-options {
    gap: var(--spacing-3);
  }

  .command-section {
    padding: var(--spacing-5);
    margin-top: var(--spacing-6);
  }

  .command-section h3 {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-3);
  }

  .command-tabs {
    flex-direction: column;
    width: 100%;
  }
}

@media (max-width: 480px) {
  .container {
    padding: var(--spacing-4);
  }

  .header h1 {
    font-size: var(--font-size-xl);
  }

  .filter-section,
  .command-section {
    padding: var(--spacing-4);
  }

  .legend-item {
    padding: var(--spacing-1) var(--spacing-2);
  }

  .legend-dot {
    width: 12px;
    height: 12px;
  }
}

/**
 * Utility Classes Â∑•ÂÖ∑Á±ª
 * Neumorphism Design System - Utility Classes
 */

/* ========== Display ÊòæÁ§∫ ========== */

.hidden {
  display: none !important;
}

.block {
  display: block !important;
}

.inline-block {
  display: inline-block !important;
}

.flex {
  display: flex !important;
}

.inline-flex {
  display: inline-flex !important;
}

/* ========== Visibility ÂèØËßÅÊÄß ========== */

.invisible {
  visibility: hidden !important;
}

.visible {
  visibility: visible !important;
}

/* ========== Flex Direction ÂºπÊÄßÊñπÂêë ========== */

.flex-row {
  flex-direction: row !important;
}

.flex-col {
  flex-direction: column !important;
}

/* ========== Flex Wrap ÂºπÊÄßÊç¢Ë°å ========== */

.flex-wrap {
  flex-wrap: wrap !important;
}

.flex-nowrap {
  flex-wrap: nowrap !important;
}

/* ========== Justify Content ‰∏ªËΩ¥ÂØπÈΩê ========== */

.justify-start {
  justify-content: flex-start !important;
}

.justify-center {
  justify-content: center !important;
}

.justify-end {
  justify-content: flex-end !important;
}

.justify-between {
  justify-content: space-between !important;
}

/* ========== Align Items ‰∫§ÂèâËΩ¥ÂØπÈΩê ========== */

.items-start {
  align-items: flex-start !important;
}

.items-center {
  align-items: center !important;
}

.items-end {
  align-items: flex-end !important;
}

/* ========== Text Alignment ÊñáÊú¨ÂØπÈΩê ========== */

.text-left {
  text-align: left !important;
}

.text-center {
  text-align: center !important;
}

.text-right {
  text-align: right !important;
}

/* ========== Text Transform ÊñáÊú¨ËΩ¨Êç¢ ========== */

.uppercase {
  text-transform: uppercase !important;
}

.lowercase {
  text-transform: lowercase !important;
}

.capitalize {
  text-transform: capitalize !important;
}

/* ========== Font Weight Â≠ó‰ΩìÁ≤óÁªÜ ========== */

.font-normal {
  font-weight: var(--font-weight-normal) !important;
}

.font-medium {
  font-weight: var(--font-weight-medium) !important;
}

.font-semibold {
  font-weight: var(--font-weight-semibold) !important;
}

.font-bold {
  font-weight: var(--font-weight-bold) !important;
}

.font-extrabold {
  font-weight: var(--font-weight-extrabold) !important;
}

/* ========== Font Size Â≠ó‰ΩìÂ§ßÂ∞è ========== */

.text-xs {
  font-size: var(--font-size-xs) !important;
}

.text-sm {
  font-size: var(--font-size-sm) !important;
}

.text-base {
  font-size: var(--font-size-base) !important;
}

.text-lg {
  font-size: var(--font-size-lg) !important;
}

.text-xl {
  font-size: var(--font-size-xl) !important;
}

/* ========== Color È¢úËâ≤ ========== */

.text-muted {
  color: var(--color-muted) !important;
}

.text-fg {
  color: var(--color-fg) !important;
}

.text-success {
  color: var(--color-success) !important;
}

.text-warning {
  color: var(--color-warning) !important;
}

.text-danger {
  color: var(--color-danger) !important;
}

.text-info {
  color: var(--color-info) !important;
}

/* ========== Margin Â§ñËæπË∑ù ========== */

.m-0 {
  margin: 0 !important;
}
.m-1 {
  margin: var(--spacing-1) !important;
}
.m-2 {
  margin: var(--spacing-2) !important;
}
.m-3 {
  margin: var(--spacing-3) !important;
}
.m-4 {
  margin: var(--spacing-4) !important;
}
.m-5 {
  margin: var(--spacing-5) !important;
}
.m-6 {
  margin: var(--spacing-6) !important;
}
.m-8 {
  margin: var(--spacing-8) !important;
}

.mt-0 {
  margin-top: 0 !important;
}
.mt-2 {
  margin-top: var(--spacing-2) !important;
}
.mt-3 {
  margin-top: var(--spacing-3) !important;
}
.mt-4 {
  margin-top: var(--spacing-4) !important;
}
.mt-6 {
  margin-top: var(--spacing-6) !important;
}
.mt-8 {
  margin-top: var(--spacing-8) !important;
}

.mb-0 {
  margin-bottom: 0 !important;
}
.mb-2 {
  margin-bottom: var(--spacing-2) !important;
}
.mb-3 {
  margin-bottom: var(--spacing-3) !important;
}
.mb-4 {
  margin-bottom: var(--spacing-4) !important;
}
.mb-6 {
  margin-bottom: var(--spacing-6) !important;
}
.mb-8 {
  margin-bottom: var(--spacing-8) !important;
}

.ml-0 {
  margin-left: 0 !important;
}
.ml-2 {
  margin-left: var(--spacing-2) !important;
}
.ml-3 {
  margin-left: var(--spacing-3) !important;
}
.ml-4 {
  margin-left: var(--spacing-4) !important;
}
.ml-auto {
  margin-left: auto !important;
}

.mr-0 {
  margin-right: 0 !important;
}
.mr-2 {
  margin-right: var(--spacing-2) !important;
}
.mr-3 {
  margin-right: var(--spacing-3) !important;
}
.mr-4 {
  margin-right: var(--spacing-4) !important;
}
.mr-auto {
  margin-right: auto !important;
}

/* ========== Padding ÂÜÖËæπË∑ù ========== */

.p-0 {
  padding: 0 !important;
}
.p-2 {
  padding: var(--spacing-2) !important;
}
.p-3 {
  padding: var(--spacing-3) !important;
}
.p-4 {
  padding: var(--spacing-4) !important;
}
.p-5 {
  padding: var(--spacing-5) !important;
}
.p-6 {
  padding: var(--spacing-6) !important;
}
.p-8 {
  padding: var(--spacing-8) !important;
}

.pt-2 {
  padding-top: var(--spacing-2) !important;
}
.pt-3 {
  padding-top: var(--spacing-3) !important;
}
.pt-4 {
  padding-top: var(--spacing-4) !important;
}
.pt-6 {
  padding-top: var(--spacing-6) !important;
}

.pb-2 {
  padding-bottom: var(--spacing-2) !important;
}
.pb-3 {
  padding-bottom: var(--spacing-3) !important;
}
.pb-4 {
  padding-bottom: var(--spacing-4) !important;
}
.pb-6 {
  padding-bottom: var(--spacing-6) !important;
}

.pl-2 {
  padding-left: var(--spacing-2) !important;
}
.pl-3 {
  padding-left: var(--spacing-3) !important;
}
.pl-4 {
  padding-left: var(--spacing-4) !important;
}
.pl-6 {
  padding-left: var(--spacing-6) !important;
}

.pr-2 {
  padding-right: var(--spacing-2) !important;
}
.pr-3 {
  padding-right: var(--spacing-3) !important;
}
.pr-4 {
  padding-right: var(--spacing-4) !important;
}
.pr-6 {
  padding-right: var(--spacing-6) !important;
}

/* ========== Gap Èó¥Ë∑ù ========== */

.gap-1 {
  gap: var(--spacing-1) !important;
}
.gap-2 {
  gap: var(--spacing-2) !important;
}
.gap-3 {
  gap: var(--spacing-3) !important;
}
.gap-4 {
  gap: var(--spacing-4) !important;
}
.gap-5 {
  gap: var(--spacing-5) !important;
}
.gap-6 {
  gap: var(--spacing-6) !important;
}

/* ========== Width ÂÆΩÂ∫¶ ========== */

.w-full {
  width: 100% !important;
}

.w-auto {
  width: auto !important;
}

/* ========== Height È´òÂ∫¶ ========== */

.h-full {
  height: 100% !important;
}

.h-auto {
  height: auto !important;
}

/* ========== Cursor ÂÖâÊ†á ========== */

.cursor-pointer {
  cursor: pointer !important;
}

.cursor-not-allowed {
  cursor: not-allowed !important;
}

.cursor-default {
  cursor: default !important;
}

/* ========== Opacity ÈÄèÊòéÂ∫¶ ========== */

.opacity-0 {
  opacity: 0 !important;
}
.opacity-50 {
  opacity: 0.5 !important;
}
.opacity-75 {
  opacity: 0.75 !important;
}
.opacity-100 {
  opacity: 1 !important;
}

/* ========== Overflow Ê∫¢Âá∫ ========== */

.overflow-hidden {
  overflow: hidden !important;
}

.overflow-auto {
  overflow: auto !important;
}

.overflow-scroll {
  overflow: scroll !important;
}

/* ========== Position ÂÆö‰Ωç ========== */

.relative {
  position: relative !important;
}

.absolute {
  position: absolute !important;
}

.fixed {
  position: fixed !important;
}

.sticky {
  position: sticky !important;
}

/* ========== Z-Index Â±ÇÁ∫ß ========== */

.z-10 {
  z-index: 10 !important;
}

.z-20 {
  z-index: 20 !important;
}

.z-50 {
  z-index: 50 !important;
}

.z-100 {
  z-index: 100 !important;
}

/* ========== Border Radius ÂúÜËßí ========== */

.rounded-none {
  border-radius: 0 !important;
}

.rounded-sm {
  border-radius: var(--radius-small) !important;
}

.rounded {
  border-radius: var(--radius-base) !important;
}

.rounded-lg {
  border-radius: var(--radius-large) !important;
}

.rounded-full {
  border-radius: var(--radius-full) !important;
}

/* ========== Transitions ËøáÊ∏° ========== */

.transition-all {
  transition: all var(--transition-base) !important;
}

.transition-fast {
  transition: all var(--transition-fast) !important;
}

.transition-none {
  transition: none !important;
}

/* ========== Transform ÂèòÊç¢ ========== */

.scale-95 {
  transform: scale(0.95) !important;
}

.scale-100 {
  transform: scale(1) !important;
}

.scale-105 {
  transform: scale(1.05) !important;
}

/* ========== Pointer Events ÊåáÈíà‰∫ã‰ª∂ ========== */

.pointer-events-none {
  pointer-events: none !important;
}

.pointer-events-auto {
  pointer-events: auto !important;
}

/* ========== User Select Áî®Êà∑ÈÄâÊã© ========== */

.select-none {
  user-select: none !important;
}

.select-text {
  user-select: text !important;
}

.select-all {
  user-select: all !important;
}

/* ========== Highlight È´ò‰∫Æ ========== */

.highlight {
  background: linear-gradient(
    135deg,
    rgba(255, 223, 0, 0.3),
    rgba(255, 235, 59, 0.3)
  );
  border-radius: var(--radius-small);
  padding: 2px 4px;
  box-shadow: inset 1px 1px 2px rgba(255, 235, 59, 0.4),
    inset -1px -1px 2px rgba(255, 255, 255, 0.2);
}

/* ========== Scrollbar Styling ÊªöÂä®Êù°Ê†∑Âºè ========== */

.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: rgba(163, 177, 198, 0.1);
  border-radius: var(--radius-full);
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: rgba(163, 177, 198, 0.3);
  border-radius: var(--radius-full);
  transition: background var(--transition-fast);
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: rgba(163, 177, 198, 0.5);
}

/**
 * Component Styles - Neumorphism Design System
 * All UI components with proper shadow physics
 */

/* ========== Buttons ========== */

.btn,
.filter-button,
.command-tab,
.copy-button,
.copy-line-button,
.modal-button,
.remark-modal-button,
.theme-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-base);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  font-family: var(--font-body);
  background: var(--color-bg);
  color: var(--color-fg);
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-extruded-small);
  transition: all var(--transition-base);
  min-height: 36px;
  min-width: 36px;
}

.btn:hover,
.filter-button:hover,
.copy-button:hover,
.copy-line-button:hover,
.modal-button:hover,
.remark-modal-button:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-extruded-hover);
}

.btn:active,
.filter-button:active,
.copy-button:active,
.modal-button:active,
.remark-modal-button:active {
  transform: translateY(0.5px);
  box-shadow: var(--shadow-inset-small);
}

/* Primary Button (Accent) */
.btn-primary,
.filter-button.active,
.command-tab.active,
.theme-button.active,
.modal-button.confirm,
.remark-save {
  background: var(--color-accent);
  color: white;
  box-shadow: 5px 5px 10px rgba(108, 99, 255, 0.3),
    -5px -5px 10px rgba(255, 255, 255, 0.1);
}

.btn-primary:hover,
.filter-button.active:hover,
.modal-button.confirm:hover,
.remark-save:hover {
  background: var(--color-accent-light);
  box-shadow: 7px 7px 14px rgba(108, 99, 255, 0.4),
    -7px -7px 14px rgba(255, 255, 255, 0.15);
}

/* Success Button */
.btn-success {
  background: var(--color-success);
  color: white;
}

/* Danger Button */
.btn-danger,
.remark-delete {
  background: var(--color-danger);
  color: white;
}

/* Info Button */
.btn-info {
  background: var(--color-info);
  color: white;
}

/* Small Buttons */
.btn-small,
.ignore-button,
.remark-button,
.vscode-button,
.view-changes-btn,
.compare-in-vscode,
.copy-line-button {
  padding: var(--spacing-1) var(--spacing-2);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  min-height: 26px;
  border-radius: var(--radius-small);
  white-space: nowrap;
  flex-shrink: 0;
}

.ignore-button {
  background: var(--color-danger);
  color: white;
  opacity: 0.9;
}

.remark-button {
  background: var(--color-info);
  color: white;
  opacity: 0.9;
}

.ignore-button:hover,
.remark-button:hover {
  opacity: 1;
  transform: translateY(-1px);
}

.vscode-button,
.compare-in-vscode {
  background: #0066b8;
  color: white;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-1);
  flex-shrink: 0;
}

.vscode-button svg,
.compare-in-vscode svg {
  width: 12px;
  height: 12px;
  min-width: 12px;
  min-height: 12px;
  fill: currentColor;
  display: block;
  flex-shrink: 0;
}

.view-changes-btn {
  background: var(--color-bg);
  color: var(--color-fg);
  box-shadow: var(--shadow-extruded-small);
}

/* Command Tab */
.command-tab {
  background: transparent;
  box-shadow: none;
  color: var(--color-muted);
  border-radius: var(--radius-base);
  padding: var(--spacing-2) var(--spacing-4);
  min-height: 36px;
  font-weight: var(--font-weight-medium);
  transition: all var(--transition-base);
}

.command-tab:hover:not(.active) {
  color: var(--color-fg);
  background: rgba(163, 177, 198, 0.1);
}

.command-tab.active {
  background: var(--color-accent);
  color: white;
  font-weight: var(--font-weight-bold);
  box-shadow: var(--shadow-extruded-small);
}

/* Theme/Layout Switcher */
.theme-switcher {
  display: inline-flex;
  align-items: center;
  background: var(--color-bg);
  border-radius: var(--radius-full);
  padding: var(--spacing-1);
  box-shadow: var(--shadow-inset-small);
  gap: var(--spacing-1);
}

.theme-button {
  border-radius: var(--radius-full);
  padding: var(--spacing-2) var(--spacing-4);
  min-height: 36px;
  gap: var(--spacing-2);
  box-shadow: none;
  background: transparent;
  color: var(--color-muted);
}

.theme-button.active {
  background: var(--color-accent);
  color: white;
  box-shadow: var(--shadow-extruded-small);
}

.theme-button:hover:not(.active) {
  color: var(--color-fg);
}

/* ========== Cards ========== */

.card,
.container {
  background: var(--color-bg);
  border-radius: var(--radius-container);
  padding: var(--spacing-8);
  box-shadow: var(--shadow-extruded);
  transition: all var(--transition-base);
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-extruded-hover);
}

/* ========== Commit Cards ========== */

.commit {
  display: flex;
  flex-direction: column;
  padding: var(--spacing-2) var(--spacing-3);
  border-radius: var(--radius-base);
  background: var(--color-bg);
  box-shadow: var(--shadow-extruded);
  position: relative;
  transition: all var(--transition-base);
  margin-bottom: var(--spacing-2);
}

.commit-container.source .commit {
  border-left: 4px solid var(--color-success);
  border-top-left-radius: 0;
  background: linear-gradient(
    135deg,
    rgba(40, 167, 69, 0.02) 0%,
    var(--color-bg) 100%
  );
}

.commit-container.target .commit {
  border-right: 4px solid var(--color-warning);
  border-top-right-radius: 0;
  background: linear-gradient(
    225deg,
    rgba(255, 152, 0, 0.02) 0%,
    var(--color-bg) 100%
  );
}

.commit-container.both .commit {
  border-top: 4px solid var(--color-success);
  border-left: none;
  border-right: none;
  border-radius: var(--radius-base);
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  background: linear-gradient(
    180deg,
    rgba(40, 167, 69, 0.02) 0%,
    var(--color-bg) 100%
  );
}

.commit-container.both .commit.matched-by-message {
  background: linear-gradient(
    180deg,
    rgba(24, 144, 255, 0.02) 0%,
    var(--color-bg) 100%
  );
  border-top-color: var(--color-info);
}

.commit.ignored {
  opacity: 0.5;
  box-shadow: var(--shadow-inset-small);
}

/* Commit Badge */
.commit-badge {
  position: absolute;
  top: -10px;
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-extrabold);
  color: white;
  box-shadow: var(--shadow-extruded-small);
  z-index: var(--z-base);
  letter-spacing: 0.02em;
}

.commit-container.source .commit-badge {
  left: var(--spacing-3);
  background: var(--color-success);
}

.commit-container.target .commit-badge {
  right: var(--spacing-3);
  background: var(--color-warning);
}

.commit-container.both .commit-badge {
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-success);
}

.commit-container.both .commit-badge.message-matched {
  background: var(--color-info);
}

/* Commit Content */
.commit-time {
  color: var(--color-muted);
  font-size: var(--font-size-xs);
  margin-bottom: var(--spacing-1);
  margin-top: var(--spacing-2);
  font-weight: var(--font-weight-normal);
}

.commit-message {
  font-weight: var(--font-weight-semibold);
  color: var(--color-fg);
  margin-bottom: var(--spacing-2);
  cursor: pointer;
  transition: color var(--transition-fast);
  font-size: var(--font-size-base);
  line-height: 1.5;
  word-wrap: break-word;
  word-break: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}

.commit-message:hover {
  color: var(--color-accent);
}

.commit-details {
  display: flex;
  flex-wrap: wrap;
  font-size: var(--font-size-xs);
  color: var(--color-muted);
  gap: var(--spacing-2);
  margin-bottom: var(--spacing-2);
  align-items: center;
}

.commit-author {
  margin-right: var(--spacing-1);
  font-weight: var(--font-weight-medium);
  color: var(--color-fg);
}

.commit-hash {
  font-family: var(--font-mono);
  cursor: pointer;
  background: var(--color-bg);
  padding: var(--spacing-1) var(--spacing-2);
  border-radius: var(--radius-small);
  box-shadow: var(--shadow-inset-small);
  transition: all var(--transition-fast);
  font-size: var(--font-size-xs);
}

.commit-hash:hover {
  box-shadow: var(--shadow-inset);
  transform: translateY(1px);
}

.commit-hash-pair {
  background: var(--color-bg);
  padding: var(--spacing-3);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-inset-small);
  margin-top: var(--spacing-2);
}

.commit-hash-branch {
  display: flex;
  align-items: center;
  gap: var(--spacing-2);
  padding: var(--spacing-1);
  margin-bottom: var(--spacing-1);
}

.commit-hash-branch:last-child {
  background: rgba(255, 152, 0, 0.05);
  border-radius: var(--radius-small);
}

.branch-label {
  min-width: 80px;
  font-weight: var(--font-weight-bold);
  color: var(--color-fg);
  font-size: var(--font-size-xs);
}

/* ========== Inputs ========== */

.input,
.search-input,
.remark-textarea {
  width: 100%;
  padding: var(--spacing-3) var(--spacing-4);
  border: none;
  border-radius: var(--radius-base);
  font-size: var(--font-size-sm);
  font-family: var(--font-body);
  background: var(--color-bg);
  color: var(--color-fg);
  box-shadow: var(--shadow-inset);
  transition: all var(--transition-base);
}

.input:focus,
.search-input:focus,
.remark-textarea:focus {
  box-shadow: var(--shadow-inset-deep);
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.input::placeholder,
.search-input::placeholder,
.remark-textarea::placeholder {
  color: var(--color-muted);
  opacity: 0.6;
}

.remark-textarea {
  min-height: 120px;
  resize: vertical;
  line-height: var(--line-height-relaxed);
}

/* ========== Checkboxes ========== */

.filter-checkbox,
.search-checkbox {
  display: flex;
  align-items: center;
  cursor: pointer;
  font-size: var(--font-size-sm);
  color: var(--color-muted);
  gap: var(--spacing-2);
  white-space: nowrap;
  flex-shrink: 0;
}

.filter-checkbox input[type="checkbox"],
.search-checkbox input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  width: 20px;
  height: 20px;
  min-width: 20px;
  min-height: 20px;
  flex-shrink: 0;
  border-radius: var(--radius-small);
  background: var(--color-bg);
  box-shadow: var(--shadow-inset-small);
  position: relative;
  transition: all var(--transition-base);
}

.filter-checkbox input[type="checkbox"]:hover,
.search-checkbox input[type="checkbox"]:hover {
  box-shadow: var(--shadow-inset);
}

.filter-checkbox input[type="checkbox"]:checked,
.search-checkbox input[type="checkbox"]:checked {
  background: var(--color-accent);
  box-shadow: var(--shadow-extruded-small);
}

.filter-checkbox input[type="checkbox"]:checked::after,
.search-checkbox input[type="checkbox"]:checked::after {
  content: "‚úì";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 14px;
  font-weight: var(--font-weight-bold);
}

.filter-checkbox span,
.search-checkbox span {
  white-space: nowrap;
  user-select: none;
}

/* ========== Modals ========== */

.modal,
.remark-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(8px);
  z-index: var(--z-modal-backdrop);
  align-items: center;
  justify-content: center;
}

.modal.show,
.remark-modal.show {
  display: flex;
}

.modal-content,
.remark-modal-content {
  position: relative;
  background: var(--color-bg);
  padding: var(--spacing-5);
  border-radius: var(--radius-container);
  box-shadow: 20px 20px 60px rgba(163, 177, 198, 0.6),
    -20px -20px 60px rgba(255, 255, 255, 0.8),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow: auto;
  z-index: var(--z-modal);
}

.modal h3,
.remark-modal-content h3 {
  margin-top: 0;
  margin-bottom: var(--spacing-6);
  color: var(--color-fg);
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  font-family: var(--font-display);
}

/* Reason List */
.reason-list {
  margin: var(--spacing-4) 0;
  max-height: 300px;
  overflow-y: auto;
}

.reason-option {
  display: flex;
  align-items: center;
  padding: var(--spacing-3) var(--spacing-4);
  border-radius: var(--radius-base);
  margin-bottom: var(--spacing-3);
  cursor: pointer;
  background: var(--color-bg);
  box-shadow: var(--shadow-extruded-small);
  transition: all var(--transition-base);
}

.reason-option:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-extruded-hover);
}

.reason-option.selected {
  box-shadow: var(--shadow-inset-small);
  background: rgba(108, 99, 255, 0.05);
}

.reason-option input[type="radio"] {
  margin-right: var(--spacing-3);
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.reason-option label {
  flex: 1;
  cursor: pointer;
  font-size: var(--font-size-sm);
}

.custom-reason {
  display: none;
  margin-top: var(--spacing-4);
}

.custom-reason.show {
  display: block;
}

/* Modal Buttons */
.modal-buttons,
.remark-modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-3);
  margin-top: var(--spacing-6);
}

.remark-delete {
  margin-right: auto;
}

/* ========== Info Displays ========== */

.ignore-reason,
.commit-remark {
  font-size: var(--font-size-xs);
  color: var(--color-muted);
  margin: var(--spacing-3) 0 0 0;
  padding: var(--spacing-3) var(--spacing-4);
  background: var(--color-bg);
  border-radius: var(--radius-small);
  box-shadow: var(--shadow-inset-small);
  line-height: var(--line-height-relaxed);
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-2);
}

.ignore-reason-title,
.commit-remark-title {
  font-weight: var(--font-weight-bold);
  color: var(--color-fg);
  white-space: nowrap;
}

.cherry-pick-time {
  margin-top: var(--spacing-3);
  padding: var(--spacing-2) var(--spacing-4);
  background: rgba(255, 152, 0, 0.05);
  border-left: 3px solid var(--color-warning);
  border-radius: var(--radius-small);
  font-size: var(--font-size-xs);
  display: flex;
  align-items: center;
  gap: var(--spacing-2);
}

.cherry-pick-label {
  font-weight: var(--font-weight-bold);
  color: #e07600;
}

/* ========== Loading & Toast ========== */

.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: var(--z-modal);
  opacity: 0;
  visibility: hidden;
  transition: all var(--transition-base);
}

.loading-overlay.show {
  opacity: 1;
  visibility: visible;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 6px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--color-accent);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.success-toast {
  position: fixed;
  top: var(--spacing-6);
  right: var(--spacing-6);
  background: var(--color-success);
  color: white;
  padding: var(--spacing-4) var(--spacing-6);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-extruded-hover);
  z-index: var(--z-tooltip);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  opacity: 0;
  transform: translateY(-20px);
  transition: all var(--transition-base);
}

.success-toast.show {
  opacity: 1;
  transform: translateY(0);
}

/* ========== Back to Top ========== */

.back-to-top {
  position: fixed;
  bottom: var(--spacing-8);
  right: var(--spacing-8);
  width: 56px;
  height: 56px;
  background: var(--color-accent);
  color: white;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: var(--shadow-extruded);
  opacity: 0;
  visibility: hidden;
  transition: all var(--transition-base);
  font-size: var(--font-size-2xl);
  z-index: var(--z-fixed);
  border: none;
}

.back-to-top.show {
  opacity: 1;
  visibility: visible;
}

.back-to-top:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-extruded-hover);
}

/* ========== Legend ========== */

.legend-item {
  display: inline-flex;
  align-items: center;
  background: var(--color-bg);
  padding: var(--spacing-2) var(--spacing-5);
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-extruded-small);
  font-size: var(--font-size-sm);
  transition: transform var(--transition-fast);
  gap: var(--spacing-2);
}

.legend-item:hover {
  transform: translateY(-1px);
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  box-shadow: var(--shadow-extruded-small);
}

.legend-dot.source {
  background: var(--color-success);
}

.legend-dot.target {
  background: var(--color-warning);
}

.legend-dot.both {
  background: var(--color-info);
}

/* ========== Branch Indicator (Flat Layout) ========== */

.timeline.flat-layout .branch-indicator {
  position: absolute;
  top: var(--spacing-4);
  width: 14px;
  height: 14px;
  border-radius: 50%;
  box-shadow: var(--shadow-extruded-small);
}

.timeline.flat-layout .commit-container.source .branch-indicator {
  right: var(--spacing-4);
  background: var(--color-success);
}

.timeline.flat-layout .commit-container.target .branch-indicator {
  left: var(--spacing-4);
  background: var(--color-warning);
}

.timeline.flat-layout .commit-container.both .branch-indicator {
  background: linear-gradient(
    135deg,
    var(--color-success) 50%,
    var(--color-warning) 50%
  );
}

/* ========== Responsive ========== */

@media (max-width: 768px) {
  .btn,
  .filter-button,
  .modal-button,
  .remark-modal-button {
    min-height: 48px;
    padding: var(--spacing-3) var(--spacing-5);
  }

  .modal-content,
  .remark-modal-content {
    width: 95%;
    padding: var(--spacing-6);
  }

  .back-to-top {
    bottom: var(--spacing-6);
    right: var(--spacing-6);
    width: 48px;
    height: 48px;
  }
}


    </style>
  </head>
  <body data-layout="flat">
    <!-- Ê∑ªÂä†ÂøΩÁï•ÂéüÂõ†ÈÄâÊã©ÂºπÁ™ó -->
    <div id="ignoreModal" class="modal">
      <div class="modal-content">
        <h3>ÈÄâÊã©ÂøΩÁï•ÂéüÂõ†</h3>
        <div class="reason-list" id="reasonList">
          <!-- ÂéüÂõ†ÈÄâÈ°πÂ∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÊ∑ªÂä† -->
        </div>
        <div id="customReasonInput" class="custom-reason">
          <input
            type="text"
            placeholder="ËØ∑ËæìÂÖ•ÂøΩÁï•ÂéüÂõ†"
            id="customReasonText"
          />
        </div>
        <div class="modal-buttons">
          <button class="modal-button cancel">ÂèñÊ∂à</button>
          <button class="modal-button confirm">Á°ÆËÆ§</button>
        </div>
      </div>
    </div>

    <!-- Ê∑ªÂä†Â§áÊ≥®ÂºπÁ™ó -->
    <div id="remarkModal" class="remark-modal">
      <div class="remark-modal-content">
        <h3>ÁºñËæëÂ§áÊ≥®</h3>
        <textarea
          id="remarkText"
          class="remark-textarea"
          placeholder="ËØ∑ËæìÂÖ•Â§áÊ≥®ÂÜÖÂÆπ..."
        ></textarea>
        <div class="remark-modal-buttons">
          <button
            class="remark-modal-button remark-delete"
            id="deleteRemarkBtn"
          >
            Âà†Èô§Â§áÊ≥®
          </button>
          <button class="remark-modal-button remark-cancel">ÂèñÊ∂à</button>
          <button class="remark-modal-button remark-save">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>

    <!-- Ê∑ªÂä†loadingË¶ÜÁõñÂ±Ç -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- Ê∑ªÂä†ËøîÂõûÈ°∂ÈÉ®ÊåâÈíÆ -->
    <div id="backToTop" class="back-to-top">‚Üë</div>

    <div class="container">
      <div class="header">
        <div>
          <h1>ÂàÜÊîØÊèê‰∫§ÂØπÊØî</h1>
          <div class="meta-info">
            <div>ÁîüÊàêÊó∂Èó¥: 2026/01/19 14:52</div>
            <div id="authorInfo" style="display: none">Êèê‰∫§ËÄÖ: "ÂÖ®ÈÉ®"</div>
            <div id="timeRangeInfo" style="display: none">
              Êó∂Èó¥ËåÉÂõ¥: "ÂÖ®ÈÉ®Êó∂Èó¥"
            </div>
          </div>
        </div>
        <div class="timeline-legend">
          <div class="legend-item">
            <span class="legend-dot source"></span> "main" (Âü∫ÂáÜÂàÜÊîØ)
          </div>
          <div class="legend-item">
            <span class="legend-dot target"></span> "feature/test"
          </div>
          <div class="legend-item">
            <span
              class="legend-dot both"
              style="background-color: #1890ff"
            ></span>
            Ê∂àÊÅØÁõ∏ÂêåÁöÑÂÖ±ÂêåÊèê‰∫§
          </div>
        </div>

        <div class="theme-switcher">
          <button id="chatLayoutBtn" class="theme-button">
            <span>ËÅäÂ§©Â∏ÉÂ±Ä</span>
            <span class="layout-icon">üí¨</span>
          </button>
          <button id="flatLayoutBtn" class="theme-button active">
            <span>ÂàóË°®Â∏ÉÂ±Ä</span>
            <span class="layout-icon">üìë</span>
          </button>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-buttons">
          <button class="filter-button active" data-filter="all">
            ÂÖ®ÈÉ®Êèê‰∫§
          </button>
          <button class="filter-button" data-filter="source">
            ‰ªÖ"main"ÂàÜÊîØ
          </button>
          <button class="filter-button" data-filter="target">
            ‰ªÖ"feature/test"ÂàÜÊîØ
          </button>
          <button class="filter-button" data-filter="common">ÂÖ±ÂêåÊèê‰∫§</button>
          <button class="filter-button" data-filter="ignored">
            Â∑≤ÂøΩÁï•Êèê‰∫§
          </button>
        </div>

        <div class="sub-filter-section" id="subFilterSection">
          <label class="filter-checkbox">
            <input type="checkbox" id="hideIgnoredCommits" checked />
            <span>ÈöêËóèÂ∑≤ÂøΩÁï•Êèê‰∫§</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" id="hideCommonCommits" />
            <span>ÈöêËóèÂÖ±ÂêåÊèê‰∫§</span>
          </label>
        </div>

        <div class="search-section">
          <div class="search-container">
            <input
              type="text"
              class="search-input"
              id="searchInput"
              placeholder="ÊêúÁ¥¢Êèê‰∫§‰ø°ÊÅØ„ÄÅ‰ΩúËÄÖÊàñÂìàÂ∏å..."
            />
            <button class="clear-search" id="clearSearch">‚úï</button>
            <div class="search-options">
              <label class="search-checkbox">
                <input type="checkbox" id="searchMessage" checked />
                <span>Êèê‰∫§‰ø°ÊÅØ</span>
              </label>
              <label class="search-checkbox">
                <input type="checkbox" id="searchAuthor" checked />
                <span>‰ΩúËÄÖ</span>
              </label>
              <label class="search-checkbox">
                <input type="checkbox" id="searchHash" />
                <span>ÂìàÂ∏å</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="timeline" id="timeline"></div>

      <div class="command-section">
        <div class="command-tabs">
          <button class="command-tab active" data-command="source-to-target">
            "main" ‚Üí "feature/test"
          </button>
          <button class="command-tab" data-command="target-to-source">
            "feature/test" ‚Üí "main"
          </button>
        </div>

        <div id="source-to-target-content" class="command-content active">
          <h3>
            Cherry-pick Êåá‰ª§ ("main" ‚Üí "feature/test")
            <button class="copy-button copy-source-to-target-button">
              Â§çÂà∂ÂÖ®ÈÉ®
            </button>
          </h3>
          <div id="source-to-target-commands-container"></div>
          <pre
            style="display: none"
          ><code id="source-to-target-commands"></code></pre>
        </div>

        <div id="target-to-source-content" class="command-content">
          <h3>
            Cherry-pick Êåá‰ª§ ("feature/test" ‚Üí "main")
            <button class="copy-button copy-target-to-source-button">
              Â§çÂà∂ÂÖ®ÈÉ®
            </button>
          </h3>
          <div id="target-to-source-commands-container"></div>
          <pre
            style="display: none"
          ><code id="target-to-source-commands"></code></pre>
        </div>
      </div>
    </div>

    <script>
      // ÂÖ®Â±ÄÈÖçÁΩÆÂíåÊï∞ÊçÆÊ≥®ÂÖ•
      const PORT = '3002';
      const API_BASE = `http://localhost:${PORT}`;

      // ‰ªéÊ®°ÊùøÊ≥®ÂÖ•ÁöÑÊï∞ÊçÆ
      const commits = [{"hash":"abc123","message":"ÊµãËØïÊèê‰∫§1","authorName":"Âº†‰∏â","date":"2026-01-19T06:52:45.748Z","status":"source","formattedDate":"2026/01/19 14:52"},{"hash":"def456","message":"ÊµãËØïÊèê‰∫§2","authorName":"ÊùéÂõõ","date":"2026-01-19T06:52:45.748Z","status":"target","formattedDate":"2026/01/19 14:52"},{"hash":"ghi789","message":"ÂÖ±ÂêåÊèê‰∫§","authorName":"Áéã‰∫î","date":"2026-01-19T06:52:45.748Z","status":"both","formattedDate":"2026/01/19 14:52"}];
      const sourceBranch = "main";
      const targetBranch = "feature/test";
      let ignoredCommits = [{"hash":"725cb134eb9c9d2d684e95ffc9a562e87e30cd9c","reason":"‰∏çÈúÄË¶ÅÂêàÂπ∂","timestamp":"2025-03-25T01:29:31.535Z"},{"hash":"56f28a86fccf14a734057b872114ea79848fa056","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:03.419Z"},{"hash":"daa41558451d47086bbb5c6170c04cb0bb100c4a","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:06.742Z"},{"hash":"02492fa6ccf008a4c4bbddcc0945627dd0d08ccc","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:09.142Z"},{"hash":"ee5d6563d413d3f07761a8a7aaf032de624c76df","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:12.171Z"},{"hash":"eb32405edf9c30b962e9958f4025818d9f6f851a","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:14.435Z"},{"hash":"a89419be84d47d9d25e26b7492d84d01aeac4191","reason":"Â∑≤ÊâãÂä®ÂêàÂπ∂","timestamp":"2025-03-25T02:03:17.023Z"},{"hash":"762de0a627a243f47c7e2f660094e732860b9d68","reason":"‰∏çÈúÄË¶ÅÂêàÂπ∂","timestamp":"2025-03-25T02:03:55.058Z"},{"hash":"dba3eb1f8e15831093f64af3264a1114fc75cbfb","reason":"‰∏çÈúÄË¶ÅÂêàÂπ∂","timestamp":"2025-03-25T02:18:47.553Z"},{"hash":"4138ca05afe8e787fe2b88a060df368d3def3771","reason":"auto-test Â∑≤ÊúâÔºåÂéÜÂè≤ÂéüÂõ†ÂØºËá¥Áº∫Â§±ÔºåËøôÊòØ‰∏Ä‰∏™Ë°•ÂÖÖ‰øÆÊîπÔºåÊâÄ‰ª•Êó†ÈúÄ cherry-pick Âõûauto-testÂàÜÊîØ","timestamp":"2025-03-25T02:26:25.492Z"}] || [];
      let commitRemarks = [] || [];
      const author = "ÂÖ®ÈÉ®";
      const timeRange = "ÂÖ®ÈÉ®Êó∂Èó¥";

      // ÂøΩÁï•ÂéüÂõ†ÈÄâÈ°π
      const IGNORE_REASONS = [
        'Â∑≤ÊâãÂä®ÂêàÂπ∂',
        '‰∏çÈúÄË¶ÅÂêàÂπ∂',
        'Â≠òÂú®ÂÜ≤Á™Å',
        'ÂæÖËøõ‰∏ÄÊ≠•Á°ÆËÆ§',
        'ÂÖ∂‰ªñÂéüÂõ†'
      ];
    </script>

    <script>
      /**
 * Utility Functions Â∑•ÂÖ∑ÂáΩÊï∞
 * ÈÄöÁî®ÁöÑËæÖÂä©ÂáΩÊï∞
 */

/**
 * Â§çÂà∂ÂëΩ‰ª§Âùó
 * @param {string} direction - ÊñπÂêëÊ†áËØÜ ('source-to-target' Êàñ 'target-to-source')
 */
function copyCommandBlock(direction) {
  const commandsElement = document.getElementById(`${direction}-commands`);
  if (commandsElement) {
    const text = commandsElement.textContent;
    const button = document.querySelector(`.copy-${direction}-button`);
    copyToClipboard(text, button);
  }
}

/**
 * Â§çÂà∂ÊñáÊú¨Âà∞Ââ™Ë¥¥Êùø
 * @param {string} text - Ë¶ÅÂ§çÂà∂ÁöÑÊñáÊú¨
 * @param {HTMLElement} element - Ëß¶ÂèëÂ§çÂà∂ÁöÑÂÖÉÁ¥†ÔºàÁî®‰∫éÊòæÁ§∫ÊèêÁ§∫Ôºâ
 */
function copyToClipboard(text, element) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      // ÂàõÂª∫NeumorphismÈ£éÊ†ºÁöÑtoastÊèêÁ§∫
      const toast = document.createElement("div");
      toast.className = "copy-toast";
      toast.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="flex-shrink: 0;">
          <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
          <path d="M6 10L9 13L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</span>
      `;

      // ËÆæÁΩÆÊ†∑Âºè
      toast.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: var(--color-bg);
        color: var(--color-success);
        padding: var(--spacing-4) var(--spacing-5);
        border-radius: var(--radius-base);
        box-shadow: 
          8px 8px 16px rgba(163, 177, 198, 0.5),
          -8px -8px 16px rgba(255, 255, 255, 0.8),
          inset 0 0 0 1px rgba(255, 255, 255, 0.5);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        font-family: var(--font-body);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: var(--spacing-3);
        opacity: 0;
        transform: translateY(20px) scale(0.9);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        pointer-events: none;
      `;

      document.body.appendChild(toast);

      // Ëß¶ÂèëÂä®Áîª
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          toast.style.opacity = "1";
          toast.style.transform = "translateY(0) scale(1)";
        });
      });

      // 2ÁßíÂêéÊ∑°Âá∫Âπ∂ÁßªÈô§
      setTimeout(() => {
        toast.style.opacity = "0";
        toast.style.transform = "translateY(-20px) scale(0.9)";
        setTimeout(() => {
          if (toast.parentNode) {
            document.body.removeChild(toast);
          }
        }, 300);
      }, 2000);
    })
    .catch((err) => {
      console.error("Â§çÂà∂Â§±Ë¥•:", err);

      // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
      const errorToast = document.createElement("div");
      errorToast.className = "copy-toast error";
      errorToast.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style="flex-shrink: 0;">
          <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="2"/>
          <path d="M10 6V11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="10" cy="14" r="1" fill="currentColor"/>
        </svg>
        <span>Â§çÂà∂Â§±Ë¥•</span>
      `;

      errorToast.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: var(--color-bg);
        color: var(--color-danger);
        padding: var(--spacing-4) var(--spacing-5);
        border-radius: var(--radius-base);
        box-shadow: 
          8px 8px 16px rgba(163, 177, 198, 0.5),
          -8px -8px 16px rgba(255, 255, 255, 0.8),
          inset 0 0 0 1px rgba(255, 255, 255, 0.5);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        font-family: var(--font-body);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: var(--spacing-3);
        opacity: 0;
        transform: translateY(20px) scale(0.9);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        pointer-events: none;
      `;

      document.body.appendChild(errorToast);

      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          errorToast.style.opacity = "1";
          errorToast.style.transform = "translateY(0) scale(1)";
        });
      });

      setTimeout(() => {
        errorToast.style.opacity = "0";
        errorToast.style.transform = "translateY(-20px) scale(0.9)";
        setTimeout(() => {
          if (errorToast.parentNode) {
            document.body.removeChild(errorToast);
          }
        }, 300);
      }, 2000);
    });
}

/**
 * HTMLËΩ¨‰πâÔºåÈò≤Ê≠¢XSSÊîªÂáª
 * @param {string} str - Ë¶ÅËΩ¨‰πâÁöÑÂ≠óÁ¨¶‰∏≤
 * @returns {string} ËΩ¨‰πâÂêéÁöÑÂ≠óÁ¨¶‰∏≤
 */
function escapeHtml(str) {
  if (!str) return "";
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

/**
 * Ê†ºÂºèÂåñÊó•Êúü
 * @param {string|Date} date - Êó•ÊúüÂØπË±°ÊàñÂ≠óÁ¨¶‰∏≤
 * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÊó•ÊúüÂ≠óÁ¨¶‰∏≤
 */
function formatDate(date) {
  const d = new Date(date);
  return d.toLocaleString("zh-CN", {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
  });
}

/**
 * ‰ªédiff --gitË°åÊèêÂèñÊñá‰ª∂Ë∑ØÂæÑ
 * @param {string} diffGitLine - diff --gitË°å
 * @returns {string} Êñá‰ª∂Ë∑ØÂæÑ
 */
function extractFilePath(diffGitLine) {
  try {
    const parts = diffGitLine.split(" ");
    if (parts.length >= 4) {
      let path = parts[3];
      if (path.startsWith("b/")) {
        path = path.substring(2);
      }
      return path;
    }
  } catch (e) {
    console.error("ÊèêÂèñÊñá‰ª∂Ë∑ØÂæÑÂ§±Ë¥•:", e);
  }
  return "unknown-file";
}

/**
 * Â∞ÜGitÂ∑ÆÂºÇÊñáÊú¨Ëß£Êûê‰∏∫Êñá‰ª∂Âùó
 * @param {string} diffText - Git diffÊñáÊú¨
 * @returns {Array} Êñá‰ª∂ÂùóÊï∞ÁªÑ
 */
function parseDiffToFileBlocks(diffText) {
  const lines = diffText.split("\n");
  const fileBlocks = [];
  let currentFile = null;
  let inFileHeader = false;
  let currentHunk = null;
  let currentHunkContent = [];

  lines.forEach((line) => {
    if (line.startsWith("diff --git ")) {
      if (currentFile) {
        if (currentHunk) {
          currentFile.hunks.push({
            header: currentHunk,
            content: currentHunkContent,
          });
        }
        fileBlocks.push(currentFile);
      }

      currentFile = {
        header: line,
        path: extractFilePath(line),
        hunks: [],
      };
      inFileHeader = true;
      currentHunk = null;
      currentHunkContent = [];
    } else if (
      inFileHeader &&
      (line.startsWith("--- ") || line.startsWith("+++ "))
    ) {
      if (currentFile) {
        currentFile.header += "\n" + line;
      }
    } else if (line.startsWith("@@ ")) {
      inFileHeader = false;
      if (currentHunk && currentFile) {
        currentFile.hunks.push({
          header: currentHunk,
          content: currentHunkContent,
        });
      }
      currentHunk = line;
      currentHunkContent = [];
    } else if (currentFile) {
      if (inFileHeader) {
        currentFile.header += "\n" + line;
      } else if (currentHunk) {
        currentHunkContent.push(line);
      }
    }
  });

  if (currentFile && currentHunk) {
    currentFile.hunks.push({
      header: currentHunk,
      content: currentHunkContent,
    });
    fileBlocks.push(currentFile);
  }

  return fileBlocks;
}

/**
 * ÂàõÂª∫GitHubÈ£éÊ†ºÁöÑÂ∑ÆÂºÇHTML
 * @param {Object} fileBlock - Êñá‰ª∂ÂùóÂØπË±°
 * @returns {string} HTMLÂ≠óÁ¨¶‰∏≤
 */
function createGitHubStyleDiffHTML(fileBlock) {
  const filePath = fileBlock.path;

  let html = `
    <div style="margin-bottom: 16px;">
      <div style="background-color: #f6f8fa; border: 1px solid #e1e4e8; border-bottom: none; border-top-left-radius: 6px; border-top-right-radius: 6px; padding: 8px 16px; font-weight: 600;">
        ${escapeHtml(filePath)}
      </div>
  `;

  fileBlock.hunks.forEach((hunk, index) => {
    const isLast = index === fileBlock.hunks.length - 1;
    html += `
      <div style="background-color: #f8fafd; color: #586069; padding: 4px 10px; border: 1px solid #e1e4e8; border-bottom: none; font-size: 12px;">
        ${escapeHtml(hunk.header)}
      </div>
      <div style="border: 1px solid #e1e4e8; border-bottom-left-radius: ${
        isLast ? "6px" : "0"
      }; border-bottom-right-radius: ${
      isLast ? "6px" : "0"
    }; overflow: hidden;">
        <table style="border-collapse: collapse; width: 100%; tab-size: 4;">
          <tbody>
    `;

    hunk.content.forEach((line) => {
      let lineClass = "";
      let lineStyle = "";
      let prefix = "";

      if (line.startsWith("+")) {
        lineClass = "addition";
        lineStyle = "background-color: #e6ffed;";
        prefix = "+";
      } else if (line.startsWith("-")) {
        lineClass = "deletion";
        lineStyle = "background-color: #ffeef0;";
        prefix = "-";
      } else {
        lineClass = "context";
        lineStyle = "";
        prefix = " ";
      }

      const lineContent = line.substring(1);

      html += `
        <tr class="${lineClass}" style="${lineStyle}">
          <td style="width: 1%; padding: 0 10px; text-align: right; color: #bbb; border-right: 1px solid #e1e4e8; user-select: none;">${prefix}</td>
          <td style="padding: 0 10px; white-space: pre-wrap; word-break: break-all;">${escapeHtml(
            lineContent
          )}</td>
        </tr>
      `;
    });

    html += `
          </tbody>
        </table>
      </div>
    `;
  });

  html += `</div>`;
  return html;
}

/**
 * Èò≤ÊäñÂáΩÊï∞
 * @param {Function} func - Ë¶ÅÈò≤ÊäñÁöÑÂáΩÊï∞
 * @param {number} wait - Á≠âÂæÖÊó∂Èó¥ÔºàÊØ´ÁßíÔºâ
 * @returns {Function} Èò≤ÊäñÂêéÁöÑÂáΩÊï∞
 */
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

/**
 * ËäÇÊµÅÂáΩÊï∞
 * @param {Function} func - Ë¶ÅËäÇÊµÅÁöÑÂáΩÊï∞
 * @param {number} limit - Êó∂Èó¥ÈôêÂà∂ÔºàÊØ´ÁßíÔºâ
 * @returns {Function} ËäÇÊµÅÂêéÁöÑÂáΩÊï∞
 */
function throttle(func, limit) {
  let inThrottle;
  return function (...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
    }
  };
}

/**
 * API Communication Module APIÈÄö‰ø°Ê®°Âùó
 * Â§ÑÁêÜÊâÄÊúâ‰∏éÂêéÁ´ØÁöÑÊï∞ÊçÆ‰∫§‰∫í
 */

// API_BASE Áî±HTMLÊ®°ÊùøÁöÑÊï∞ÊçÆÊ≥®ÂÖ•ËÑöÊú¨ÂÆö‰πâ

/**
 * Âä†ËΩΩÂ∑≤ÂøΩÁï•ÁöÑÊèê‰∫§ÂàóË°®
 * @returns {Promise<Array>} ÂøΩÁï•ÁöÑÊèê‰∫§Êï∞ÁªÑ
 */
async function loadIgnoredCommits() {
  try {
    const response = await fetch(`${API_BASE}/ignored-commits`, {
      cache: "no-store",
      headers: {
        "Cache-Control": "no-cache, no-store",
        Pragma: "no-cache",
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return Array.isArray(data.ignoredCommits) ? data.ignoredCommits : [];
  } catch (error) {
    console.error("Âä†ËΩΩÂøΩÁï•ÁöÑÊèê‰∫§Â§±Ë¥•:", error);
    return [];
  }
}

/**
 * ‰øùÂ≠òÂ∑≤ÂøΩÁï•ÁöÑÊèê‰∫§ÂàóË°®
 * @param {Array} commits - ÂøΩÁï•ÁöÑÊèê‰∫§Êï∞ÁªÑ
 * @returns {Promise<boolean>} ÊòØÂê¶‰øùÂ≠òÊàêÂäü
 */
async function saveIgnoredCommits(commits) {
  try {
    const response = await fetch(`${API_BASE}/ignore-commit`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ ignoredCommits: commits }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    return true;
  } catch (error) {
    console.error("‰øùÂ≠òÂøΩÁï•ÁöÑÊèê‰∫§Â§±Ë¥•:", error);
    throw error;
  }
}

/**
 * Âä†ËΩΩÊèê‰∫§Â§áÊ≥®
 * @returns {Promise<Array>} Â§áÊ≥®Êï∞ÁªÑ
 */
async function loadCommitRemarks() {
  try {
    const response = await fetch(`${API_BASE}/commit-remarks`, {
      cache: "no-store",
      headers: {
        "Cache-Control": "no-cache, no-store",
        Pragma: "no-cache",
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();

    // Â§ÑÁêÜÊï∞ÊçÆÊ†ºÂºèËΩ¨Êç¢ÔºàÂêëÂêéÂÖºÂÆπÔºâ
    if (data.commitRemarks) {
      if (Array.isArray(data.commitRemarks)) {
        return data.commitRemarks;
      } else if (typeof data.commitRemarks === "object") {
        // ËΩ¨Êç¢ÊóßÊ†ºÂºèÔºàÂØπË±°Ôºâ‰∏∫Êñ∞Ê†ºÂºèÔºàÊï∞ÁªÑÔºâ
        const remarksArray = [];
        for (const hash in data.commitRemarks) {
          remarksArray.push({
            hash: hash,
            content: data.commitRemarks[hash],
            timestamp: new Date().toISOString(),
          });
        }
        console.log("Â∑≤Â∞ÜÂØπË±°Ê†ºÂºèÂ§áÊ≥®ËΩ¨Êç¢‰∏∫Êï∞ÁªÑÊ†ºÂºè");
        return remarksArray;
      }
    }

    return [];
  } catch (error) {
    console.error("Âä†ËΩΩÊèê‰∫§Â§áÊ≥®Â§±Ë¥•:", error);
    return [];
  }
}

/**
 * ‰øùÂ≠òÊèê‰∫§Â§áÊ≥®
 * @param {Array} remarks - Â§áÊ≥®Êï∞ÁªÑ
 * @returns {Promise<Object>} ‰øùÂ≠òÁªìÊûú
 */
async function saveCommitRemarks(remarks) {
  try {
    // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
    if (!Array.isArray(remarks)) {
      console.error("Â§áÊ≥®Êï∞ÊçÆÂøÖÈ°ªÊòØÊï∞ÁªÑÊ†ºÂºè");
      remarks = [];
    }

    // ËøáÊª§Êó†ÊïàÊï∞ÊçÆ
    const validRemarks = remarks.filter(
      (remark) =>
        remark &&
        remark.hash &&
        typeof remark.hash === "string" &&
        remark.hash.trim().length > 0
    );

    if (validRemarks.length !== remarks.length) {
      console.warn(`ËøáÊª§‰∫Ü ${remarks.length - validRemarks.length} Êù°Êó†ÊïàÂ§áÊ≥®`);
    }

    const response = await fetch(`${API_BASE}/commit-remarks`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ commitRemarks: validRemarks }),
      cache: "no-cache",
    });

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`ÊúçÂä°Âô®ËøîÂõûÈîôËØØ: ${response.status} ${errorText}`);
    }

    const data = await response.json();
    console.log("Â§áÊ≥®‰øùÂ≠òÊàêÂäü:", data);
    return data;
  } catch (error) {
    console.error("‰øùÂ≠òÂ§áÊ≥®Â§±Ë¥•:", error);
    throw error;
  }
}

/**
 * Ëé∑ÂèñGitÊèê‰∫§ÁöÑdiffÂÜÖÂÆπ
 * @param {string} commitHash - Êèê‰∫§ÂìàÂ∏åÂÄº
 * @returns {Promise<Object>} diffÊï∞ÊçÆ
 */
async function fetchGitDiff(commitHash) {
  try {
    const response = await fetch(
      `${API_BASE}/git/show?hash=${encodeURIComponent(commitHash)}`,
      {
        method: "GET",
        headers: {
          Accept: "application/json",
          "Content-Type": "application/json",
        },
      }
    );

    if (!response.ok) {
      throw new Error(
        `ÊúçÂä°Âô®ËøîÂõûÈîôËØØ: ${response.status} ${response.statusText}`
      );
    }

    const responseObj = await response.json();

    if (!responseObj.success) {
      throw new Error(responseObj.message || "ÊúçÂä°Âô®ËøîÂõûÈîôËØØ");
    }

    return responseObj.data;
  } catch (error) {
    console.error("Ëé∑ÂèñGit diffÂ§±Ë¥•:", error);
    throw error;
  }
}

/**
 * ÈÄöÁî®ÁöÑfetchÈáçËØïÂåÖË£ÖÂô®
 * @param {Function} fetchFunc - fetchÂáΩÊï∞
 * @param {number} retries - ÈáçËØïÊ¨°Êï∞
 * @returns {Promise} fetchÁªìÊûú
 */
async function fetchWithRetry(fetchFunc, retries = 1) {
  try {
    return await fetchFunc();
  } catch (error) {
    if (retries > 0) {
      console.log(`ËØ∑Ê±ÇÂ§±Ë¥•Ôºå${retries}Ê¨°ÈáçËØïÂêéÈáçÊñ∞Â∞ùËØï...`);
      await new Promise((resolve) => setTimeout(resolve, 1000));
      return fetchWithRetry(fetchFunc, retries - 1);
    }
    throw error;
  }
}

/**
 * State Management Module Áä∂ÊÄÅÁÆ°ÁêÜÊ®°Âùó
 * ÁÆ°ÁêÜÂ∫îÁî®ÁöÑÂÖ®Â±ÄÁä∂ÊÄÅ
 */

// ÂÖ®Â±ÄÁä∂ÊÄÅÂØπË±°
const appState = {
  commits: [],
  ignoredCommits: [],
  commitRemarks: [],
  filterState: {
    mainFilter: "all",
    hideIgnored: true,
    hideCommon: false,
    searchText: "",
    searchMessage: true,
    searchAuthor: true,
    searchHash: false,
  },
  layout: "flat",
  sourceBranch: "",
  targetBranch: "",
};

/**
 * Êõ¥Êñ∞Á≠õÈÄâÁä∂ÊÄÅ
 * @param {Object} updates - Ë¶ÅÊõ¥Êñ∞ÁöÑÁä∂ÊÄÅÂ≠óÊÆµ
 */
function updateFilterState(updates) {
  appState.filterState = {
    ...appState.filterState,
    ...updates,
  };
}

/**
 * Ëé∑ÂèñÂΩìÂâçÁ≠õÈÄâÁä∂ÊÄÅ
 * @returns {Object} Á≠õÈÄâÁä∂ÊÄÅÂØπË±°
 */
function getFilterState() {
  return { ...appState.filterState };
}

/**
 * ‰øùÂ≠òÁ≠õÈÄâÁä∂ÊÄÅÂà∞URL
 */
function saveFilterStateToURL() {
  const url = new URL(window.location.href);
  url.searchParams.set("filter", appState.filterState.mainFilter);
  url.searchParams.set(
    "hideIgnored",
    appState.filterState.hideIgnored ? "1" : "0"
  );
  url.searchParams.set(
    "hideCommon",
    appState.filterState.hideCommon ? "1" : "0"
  );
  window.history.replaceState({}, "", url.toString());
}

/**
 * ‰ªéURLÂä†ËΩΩÁ≠õÈÄâÁä∂ÊÄÅ
 * @returns {Object} ‰ªéURLËß£ÊûêÁöÑÁ≠õÈÄâÁä∂ÊÄÅ
 */
function loadFilterStateFromURL() {
  const urlParams = new URLSearchParams(window.location.search);
  return {
    mainFilter: urlParams.get("filter") || "all",
    hideIgnored: urlParams.get("hideIgnored") === "1",
    hideCommon: urlParams.get("hideCommon") === "1",
  };
}

/**
 * ‰øùÂ≠òÂΩìÂâçÁ≠õÈÄâÁä∂ÊÄÅÔºàÁî®‰∫éÊìç‰ΩúÂâç‰øùÂ≠òÔºâ
 */
function saveCurrentFilterState() {
  const hideIgnoredEl = document.getElementById("hideIgnoredCommits");
  const hideCommonEl = document.getElementById("hideCommonCommits");
  const searchInputEl = document.getElementById("searchInput");
  const searchMessageEl = document.getElementById("searchMessage");
  const searchAuthorEl = document.getElementById("searchAuthor");
  const searchHashEl = document.getElementById("searchHash");

  if (
    !hideIgnoredEl ||
    !hideCommonEl ||
    !searchInputEl ||
    !searchMessageEl ||
    !searchAuthorEl ||
    !searchHashEl
  ) {
    console.warn("ÈÉ®ÂàÜÁ≠õÈÄâDOMÂÖÉÁ¥†Êú™ÊâæÂà∞ÔºåË∑≥ËøáÁä∂ÊÄÅ‰øùÂ≠ò");
    return;
  }

  appState.filterState = {
    mainFilter: document.body.getAttribute("data-current-filter") || "all",
    hideIgnored: hideIgnoredEl.checked,
    hideCommon: hideCommonEl.checked,
    searchText: searchInputEl.value.trim(),
    searchMessage: searchMessageEl.checked,
    searchAuthor: searchAuthorEl.checked,
    searchHash: searchHashEl.checked,
  };

  console.log("Â∑≤‰øùÂ≠òÁ≠õÈÄâÁä∂ÊÄÅ:", appState.filterState);
}

/**
 * ÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅÔºàÁî®‰∫éÊìç‰ΩúÂêéÊÅ¢Â§çÔºâ
 */
function restoreFilterState() {
  console.log("Ê≠£Âú®ÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅ:", appState.filterState);

  if (!appState.filterState) {
    console.warn("Ê≤°ÊúâÁ≠õÈÄâÁä∂ÊÄÅÂèØÊÅ¢Â§ç");
    return;
  }

  // ËÆæÁΩÆ‰∏ªÁ≠õÈÄâÊåâÈíÆÁä∂ÊÄÅ
  document.querySelectorAll(".filter-button").forEach((btn) => {
    btn.classList.toggle(
      "active",
      btn.getAttribute("data-filter") === appState.filterState.mainFilter
    );
  });

  document.body.setAttribute(
    "data-current-filter",
    appState.filterState.mainFilter
  );

  // Ëé∑ÂèñDOMÂÖÉÁ¥†
  const hideIgnoredEl = document.getElementById("hideIgnoredCommits");
  const hideCommonEl = document.getElementById("hideCommonCommits");
  const searchInputEl = document.getElementById("searchInput");
  const searchMessageEl = document.getElementById("searchMessage");
  const searchAuthorEl = document.getElementById("searchAuthor");
  const searchHashEl = document.getElementById("searchHash");
  const clearButton = document.getElementById("clearSearch");
  const subFilterSection = document.getElementById("subFilterSection");

  if (
    !hideIgnoredEl ||
    !hideCommonEl ||
    !searchInputEl ||
    !searchMessageEl ||
    !searchAuthorEl ||
    !searchHashEl ||
    !clearButton ||
    !subFilterSection
  ) {
    console.warn("ÈÉ®ÂàÜÁ≠õÈÄâDOMÂÖÉÁ¥†Êú™ÊâæÂà∞ÔºåË∑≥ËøáÁä∂ÊÄÅÊÅ¢Â§ç");
    return;
  }

  // ÊÅ¢Â§çÂ§çÈÄâÊ°ÜÁä∂ÊÄÅ
  hideIgnoredEl.checked = appState.filterState.hideIgnored;
  hideCommonEl.checked = appState.filterState.hideCommon;

  // ÊÅ¢Â§çÊêúÁ¥¢Áä∂ÊÄÅ
  searchInputEl.value = appState.filterState.searchText;
  searchMessageEl.checked = appState.filterState.searchMessage;
  searchAuthorEl.checked = appState.filterState.searchAuthor;
  searchHashEl.checked = appState.filterState.searchHash;

  // ÊòæÁ§∫/ÈöêËóèÊ∏ÖÈô§ÊåâÈíÆ
  if (appState.filterState.searchText) {
    clearButton.classList.add("visible");
  } else {
    clearButton.classList.remove("visible");
  }

  // ËÆæÁΩÆÂ≠êÁ≠õÈÄâÂô®ÂèØËßÅÊÄß
  if (appState.filterState.mainFilter === "all") {
    subFilterSection.classList.remove("hidden");
  } else {
    subFilterSection.classList.add("hidden");
  }

  // Â∫îÁî®Á≠õÈÄâ
  if (appState.filterState.searchText) {
    searchCommits(false);
  } else {
    applyFilters(appState.filterState.mainFilter);
  }
}

/**
 * ÂàùÂßãÂåñÁ≠õÈÄâÁä∂ÊÄÅÔºà‰ªéURLÔºâ
 */
function initializeFilterState() {
  const urlParams = loadFilterStateFromURL();

  appState.filterState = {
    ...appState.filterState,
    mainFilter: urlParams.mainFilter,
    hideIgnored: urlParams.hideIgnored,
    hideCommon: urlParams.hideCommon,
  };

  document.body.setAttribute(
    "data-current-filter",
    appState.filterState.mainFilter
  );

  // Êõ¥Êñ∞UI
  document.querySelectorAll(".filter-button").forEach((btn) => {
    btn.classList.toggle(
      "active",
      btn.getAttribute("data-filter") === appState.filterState.mainFilter
    );
  });

  const hideIgnoredEl = document.getElementById("hideIgnoredCommits");
  const hideCommonEl = document.getElementById("hideCommonCommits");
  if (hideIgnoredEl) hideIgnoredEl.checked = appState.filterState.hideIgnored;
  if (hideCommonEl) hideCommonEl.checked = appState.filterState.hideCommon;

  const subFilterSection = document.getElementById("subFilterSection");
  if (subFilterSection) {
    if (appState.filterState.mainFilter === "all") {
      subFilterSection.classList.remove("hidden");
    } else {
      subFilterSection.classList.add("hidden");
    }
  }

  console.log("Â∑≤‰ªéURLÂàùÂßãÂåñÁ≠õÈÄâÁä∂ÊÄÅ:", appState.filterState);
}

/**
 * ËÆæÁΩÆÂ∏ÉÂ±ÄÊ®°Âºè
 * @param {string} layout - Â∏ÉÂ±ÄÊ®°Âºè ('chat' Êàñ 'flat')
 */
function setLayout(layout) {
  appState.layout = layout;
  localStorage.setItem("preferredLayout", layout);
}

/**
 * Ëé∑ÂèñÂ∏ÉÂ±ÄÊ®°Âºè
 * @returns {string} ÂΩìÂâçÂ∏ÉÂ±ÄÊ®°Âºè
 */
function getLayout() {
  return appState.layout;
}

/**
 * ‰ªélocalStorageÂä†ËΩΩÂ∏ÉÂ±ÄÂÅèÂ•Ω
 * @returns {string} ‰øùÂ≠òÁöÑÂ∏ÉÂ±ÄÊ®°Âºè
 */
function loadLayoutPreference() {
  return localStorage.getItem("preferredLayout") || "flat";
}

/**
 * Render Module Ê∏≤ÊüìÊ®°Âùó
 * Ë¥üË¥£UIÁöÑÊ∏≤ÊüìÂíåÊõ¥Êñ∞
 */

/**
 * Ê∏≤ÊüìÊèê‰∫§ÂàóË°®
 * @param {boolean} shouldRestoreState - ÊòØÂê¶ÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅ
 */
function renderCommits(shouldRestoreState = true) {
  if (shouldRestoreState) {
    saveCurrentFilterState();
  }

  const timeline = document.getElementById("timeline");
  timeline.innerHTML = "";

  const currentLayout = document.body.getAttribute("data-layout") || "flat";

  // ÊåâÊó∂Èó¥ÊéíÂ∫èÔºà‰ªéÊñ∞Âà∞ÊóßÔºâ
  const sortedCommits = [...appState.commits].sort(
    (a, b) => new Date(b.date || b.dateIso) - new Date(a.date || a.dateIso)
  );

  sortedCommits.forEach((commit) => {
    const commitRow = renderCommitCard(commit, currentLayout);
    timeline.appendChild(commitRow);
  });

  updateCherryPickCommands();

  if (shouldRestoreState) {
    restoreFilterState();
  }
}

/**
 * Ê∏≤ÊüìÂçï‰∏™Êèê‰∫§Âç°Áâá
 * @param {Object} commit - Êèê‰∫§ÂØπË±°
 * @param {string} layout - Â∏ÉÂ±ÄÊ®°Âºè
 * @returns {HTMLElement} Êèê‰∫§Ë°åÂÖÉÁ¥†
 */
function renderCommitCard(commit, layout) {
  const isIgnored = appState.ignoredCommits.some(
    (item) => item.hash === commit.hash
  );
  const ignoredCommit = appState.ignoredCommits.find(
    (item) => item.hash === commit.hash
  );
  const hasRemarkForCommit = hasRemark(commit.hash);
  const remarkContent = getRemarkContent(commit.hash);
  const isMatchedByMessage = commit.matchedByMessage === true;

  const commitRow = document.createElement("div");
  commitRow.className = "commit-row";

  const commitContainer = document.createElement("div");

  if (commit.status === "both") {
    commitContainer.className = "commit-container both";
  } else if (commit.status === "source") {
    commitContainer.className = "commit-container source";
  } else {
    commitContainer.className = "commit-container target";
  }

  let badgeText;
  let badgeClass = "";

  if (commit.status === "both") {
    badgeText = isMatchedByMessage ? "Â∑≤ÂêåÊ≠•(commit Ê∂àÊÅØÂåπÈÖç)" : "ÂÖ±ÂêåÊèê‰∫§";
    if (isMatchedByMessage) {
      badgeClass = "message-matched";
    }
  } else if (commit.status === "source") {
    badgeText = appState.sourceBranch;
  } else {
    badgeText = appState.targetBranch;
  }

  let commitClasses = `commit${isIgnored ? " ignored" : ""}`;
  if (isMatchedByMessage) {
    commitClasses += " matched-by-message";
  }

  let hashContent = "";
  const vscodeIconSvg = `<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M21.29 4.1L17.47.28a1 1 0 0 0-.71-.28h-.09a1 1 0 0 0-.67.3l-10.48 9.5-4.23-3.2a.67.67 0 0 0-.89.01l-.8.72a.67.67 0 0 0 0 .99l3.45 3.12L.6 14.56a.67.67 0 0 0 0 .99l.8.72a.67.67 0 0 0 .89.01l4.23-3.2 10.48 9.5a1 1 0 0 0 .67.3h.09a1 1 0 0 0 .71-.28l3.82-3.82a1 1 0 0 0 .3-.71V4.81a1 1 0 0 0-.3-.71zM17 18.5l-9-6.75L17 5v13.5z"/></svg>`;

  function getHashWithButtons(hash) {
    const shortHash = hash.substring(0, 7);
    return `
      <span class="commit-hash" title="${hash}">${shortHash}</span>
      <button class="vscode-button" title="Âú®VS Code‰∏≠Êü•Áúã">
        ${vscodeIconSvg}
      </button>
      <button class="view-changes-btn">
        Êü•ÁúãÂèòÊõ¥
      </button>
    `;
  }

  if (isMatchedByMessage && commit.targetHash) {
    const cherryPickTimeHtml = commit.cherryPickTime
      ? `
      <div class="cherry-pick-time">
        <span class="cherry-pick-label">üçí Cherry-pick Êó∂Èó¥:</span>
        <span class="cherry-pick-timestamp">${formatDate(
          commit.cherryPickTime
        )}</span>
      </div>
    `
      : "";

    hashContent = `
      <div class="commit-hash-pair">
        <div class="commit-hash-branch">
          <span class="branch-label">${appState.sourceBranch}:</span>
          ${getHashWithButtons(commit.hash)}
        </div>
        <div class="commit-hash-branch">
          <span class="branch-label">${appState.targetBranch}:</span>
          ${getHashWithButtons(commit.targetHash)}
        </div>
        ${cherryPickTimeHtml}
        <button class="compare-in-vscode">
          ${vscodeIconSvg} Âú®VS Code‰∏≠ÊØîËæÉ‰∏§‰∏™Êèê‰∫§
        </button>
      </div>
    `;
  } else {
    hashContent = getHashWithButtons(commit.hash);
  }

  const branchIndicator =
    layout === "flat"
      ? `<div class="branch-indicator ${badgeClass}"></div>`
      : "";

  commitContainer.innerHTML = `
    <div class="${commitClasses}" data-hash="${commit.hash}" data-status="${
    commit.status
  }">
      ${branchIndicator}
      <span class="commit-badge ${badgeClass}">${badgeText}</span>
      <div class="commit-time">${commit.formattedDate}</div>
      <div class="commit-info">
        <div class="commit-message">${escapeHtml(commit.message)}</div>
        <div class="commit-details">
          <span class="commit-author">‰ΩúËÄÖ: ${escapeHtml(
            commit.authorName
          )}</span>
          ${hashContent}
          <button class="ignore-button">
            ${isIgnored ? "ÂèñÊ∂àÂøΩÁï•" : "ÂøΩÁï•"}
          </button>
          <button class="remark-button">
            ${hasRemarkForCommit ? "ÁºñËæëÂ§áÊ≥®" : "Ê∑ªÂä†Â§áÊ≥®"}
          </button>
        </div>
        ${
          isIgnored && ignoredCommit
            ? `
          <div class="ignore-reason">
            <span class="ignore-reason-title">üö´ ÂøΩÁï•ÂéüÂõ†</span>
            <span class="ignore-reason-content">${escapeHtml(
              ignoredCommit.reason
            )}</span>
          </div>`
            : ""
        }
        ${
          remarkContent
            ? `
          <div class="commit-remark">
            <span class="commit-remark-title">üìù Â§áÊ≥®</span>
            <span class="commit-remark-content">${escapeHtml(
              remarkContent
            )}</span>
          </div>`
            : ""
        }
      </div>
    </div>
  `;

  commitRow.appendChild(commitContainer);
  return commitRow;
}

/**
 * Êõ¥Êñ∞cherry-pickÂëΩ‰ª§
 */
function updateCherryPickCommands() {
  const sourceOnlyCommits = appState.commits.filter(
    (commit) =>
      commit.status === "source" &&
      !appState.ignoredCommits.some((item) => item.hash === commit.hash)
  );

  const targetOnlyCommits = appState.commits.filter(
    (commit) =>
      commit.status === "target" &&
      !appState.ignoredCommits.some((item) => item.hash === commit.hash)
  );

  updateDirectionalCommands(
    sourceOnlyCommits,
    appState.sourceBranch,
    appState.targetBranch,
    "source-to-target"
  );
  updateDirectionalCommands(
    targetOnlyCommits,
    appState.targetBranch,
    appState.sourceBranch,
    "target-to-source"
  );
}

/**
 * ÁîüÊàêÁâπÂÆöÊñπÂêëÁöÑcherry-pickÂëΩ‰ª§
 * @param {Array} directionCommits - Êèê‰∫§ÂàóË°®
 * @param {string} fromBranch - Ê∫êÂàÜÊîØ
 * @param {string} toBranch - ÁõÆÊ†áÂàÜÊîØ
 * @param {string} direction - ÊñπÂêëÊ†áËØÜ
 */
function updateDirectionalCommands(
  directionCommits,
  fromBranch,
  toBranch,
  direction
) {
  directionCommits.sort((a, b) => new Date(b.date) - new Date(a.date));

  let commandsArray = [];
  commandsArray.push(`# ÂàáÊç¢Âà∞ ${toBranch} ÂàÜÊîØ`);
  commandsArray.push(`git checkout ${toBranch}`);
  commandsArray.push("");
  commandsArray.push(`# Cherry-pick ‰ªé ${fromBranch} ÂàÜÊîØÁöÑÊèê‰∫§`);

  directionCommits.forEach((commit) => {
    commandsArray.push(`git cherry-pick ${commit.hash}  # ${commit.message}`);
  });

  const commands = commandsArray.join("\n");

  const commandsContainer = document.getElementById(
    `${direction}-commands-container`
  );
  commandsContainer.innerHTML = "";

  commandsArray.forEach((cmd) => {
    // Ë∑≥ËøáÁ©∫Ë°åÔºå‰∏çÊ∏≤Êüì
    if (!cmd || cmd.trim() === "") {
      return;
    }

    const cmdLine = document.createElement("div");
    cmdLine.className = "command-line";

    const cmdText = document.createElement("pre");
    cmdText.textContent = cmd;
    cmdLine.appendChild(cmdText);

    if (cmd && !cmd.startsWith("#")) {
      const copyBtn = document.createElement("button");
      copyBtn.className = "copy-line-button";
      copyBtn.textContent = "Â§çÂà∂";
      copyBtn.onclick = function () {
        copyToClipboard(cmd, this);
      };
      cmdLine.appendChild(copyBtn);
    }

    commandsContainer.appendChild(cmdLine);
  });

  document.getElementById(`${direction}-commands`).textContent = commands;
}

/**
 * Êõ¥Êñ∞Â§áÊ≥®UI
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 */
function updateRemarkUI(hash) {
  const remarkElement = document.querySelector(
    `.remark-content[data-hash="${hash}"]`
  );
  if (!remarkElement) return;

  const remark = getCommitRemark(hash);

  if (remark && remark.content) {
    remarkElement.value = remark.content;
    remarkElement.classList.add("has-content");
  } else {
    remarkElement.value = "";
    remarkElement.classList.remove("has-content");
  }
}

/**
 * Êõ¥Êñ∞ÊâÄÊúâÂ§áÊ≥®UI
 */
function updateAllRemarkUI() {
  document.querySelectorAll(".commit").forEach((commitEl) => {
    const hash = commitEl.getAttribute("data-hash");
    if (hash) {
      updateRemarkUI(hash);
    }
  });
}

/**
 * Ëé∑ÂèñÂ§áÊ≥®ÂÜÖÂÆπ
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @returns {string} Â§áÊ≥®ÂÜÖÂÆπ
 */
function getRemarkContent(hash) {
  const remark = appState.commitRemarks.find((r) => r.hash === hash);
  return remark ? remark.content : "";
}

/**
 * Âà§Êñ≠ÊòØÂê¶ÊúâÂ§áÊ≥®
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @returns {boolean} ÊòØÂê¶ÊúâÂ§áÊ≥®
 */
function hasRemark(hash) {
  return appState.commitRemarks.some((r) => r.hash === hash);
}

/**
 * Ëé∑ÂèñÊèê‰∫§ÁöÑÂ§áÊ≥®ÂØπË±°
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @returns {Object|undefined} Â§áÊ≥®ÂØπË±°
 */
function getCommitRemark(hash) {
  return appState.commitRemarks.find((r) => r.hash === hash);
}

/**
 * Filter Module Á≠õÈÄâÊ®°Âùó
 * Â§ÑÁêÜÊèê‰∫§ÁöÑÁ≠õÈÄâÂíåÊêúÁ¥¢ÂäüËÉΩ
 */

/**
 * Á≠õÈÄâÊèê‰∫§
 * @param {string} type - Á≠õÈÄâÁ±ªÂûã ('all', 'source', 'target', 'common', 'ignored')
 */
function filterCommits(type) {
  const buttons = document.querySelectorAll(".filter-button");
  buttons.forEach((btn) => btn.classList.remove("active"));
  document.querySelector(`[data-filter="${type}"]`).classList.add("active");

  document.body.setAttribute("data-current-filter", type);
  updateFilterState({ mainFilter: type });

  const subFilterSection = document.getElementById("subFilterSection");
  if (type === "all") {
    subFilterSection.classList.remove("hidden");
  } else {
    subFilterSection.classList.add("hidden");
  }

  applyFilters(type);
  saveFilterStateToURL();
}

/**
 * Â∫îÁî®Á≠õÈÄâ
 * @param {string} type - Á≠õÈÄâÁ±ªÂûã
 */
function applyFilters(type) {
  const commitRows = document.querySelectorAll(".commit-row");
  const hideIgnored = document.getElementById("hideIgnoredCommits").checked;
  const hideCommon = document.getElementById("hideCommonCommits").checked;

  commitRows.forEach((row) => {
    const commitElement = row.querySelector(".commit");
    if (!commitElement) return;

    const status = commitElement.getAttribute("data-status");
    const hash = commitElement.getAttribute("data-hash");
    const isIgnored = appState.ignoredCommits.some(
      (item) => item.hash === hash
    );
    const isCommon = status === "both";

    let shouldShow = false;

    switch (type) {
      case "all":
        shouldShow = true;
        break;
      case "source":
        shouldShow = status === "source";
        break;
      case "target":
        shouldShow = status === "target";
        break;
      case "common":
        shouldShow = status === "both";
        break;
      case "ignored":
        shouldShow = isIgnored;
        break;
    }

    if (shouldShow) {
      if (hideIgnored && isIgnored && type !== "ignored") {
        shouldShow = false;
      }
      if (hideCommon && isCommon && type !== "common") {
        shouldShow = false;
      }
    }

    row.style.display = shouldShow ? "" : "none";
  });
}

/**
 * Â∫îÁî®Â≠êÁ≠õÈÄâÂô®
 */
function applySubFilters() {
  const currentFilter =
    document.body.getAttribute("data-current-filter") || "all";
  applyFilters(currentFilter);
  saveFilterStateToURL();
}

/**
 * ÊêúÁ¥¢Êèê‰∫§
 * @param {boolean} saveState - ÊòØÂê¶‰øùÂ≠òÁä∂ÊÄÅ
 */
function searchCommits(saveState = true) {
  const searchText = document
    .getElementById("searchInput")
    .value.trim()
    .toLowerCase();
  const searchMessage = document.getElementById("searchMessage").checked;
  const searchAuthor = document.getElementById("searchAuthor").checked;
  const searchHash = document.getElementById("searchHash").checked;
  const clearButton = document.getElementById("clearSearch");

  if (saveState) {
    updateFilterState({
      searchText,
      searchMessage,
      searchAuthor,
      searchHash,
    });
  }

  if (searchText) {
    clearButton.classList.add("visible");
  } else {
    clearButton.classList.remove("visible");
  }

  if (!searchText) {
    const currentFilter =
      document.body.getAttribute("data-current-filter") || "all";
    applyFilters(currentFilter);
    return;
  }

  const commitRows = document.querySelectorAll(".commit-row");

  // Ê∏ÖÈô§Áé∞ÊúâÈ´ò‰∫Æ
  commitRows.forEach((row) => {
    const commitElement = row.querySelector(".commit");
    if (!commitElement) return;

    const messageElement = commitElement.querySelector(".commit-message");
    const authorElement = commitElement.querySelector(".commit-author");
    const hashElements = commitElement.querySelectorAll(".commit-hash");

    if (messageElement) {
      messageElement.innerHTML = messageElement.innerHTML.replace(
        /<span class="highlight">([^<]+)<\/span>/g,
        "$1"
      );
    }
    if (authorElement) {
      authorElement.innerHTML = authorElement.innerHTML.replace(
        /<span class="highlight">([^<]+)<\/span>/g,
        "$1"
      );
    }
    hashElements.forEach((el) => {
      el.innerHTML = el.innerHTML.replace(
        /<span class="highlight">([^<]+)<\/span>/g,
        "$1"
      );
    });
  });

  // ÊêúÁ¥¢Âπ∂È´ò‰∫Æ
  commitRows.forEach((row) => {
    const commitElement = row.querySelector(".commit");
    if (!commitElement) return;

    let matches = false;

    if (searchMessage) {
      const messageElement = commitElement.querySelector(".commit-message");
      if (
        messageElement &&
        messageElement.textContent.toLowerCase().includes(searchText)
      ) {
        matches = true;
        highlightText(messageElement, searchText);
      }
    }

    if (searchAuthor && !matches) {
      const authorElement = commitElement.querySelector(".commit-author");
      if (
        authorElement &&
        authorElement.textContent.toLowerCase().includes(searchText)
      ) {
        matches = true;
        highlightText(authorElement, searchText);
      }
    }

    if (searchHash && !matches) {
      const hashElements = commitElement.querySelectorAll(".commit-hash");
      hashElements.forEach((hashElement) => {
        if (hashElement.textContent.toLowerCase().includes(searchText)) {
          matches = true;
          highlightText(hashElement, searchText);
        }
      });
    }

    row.style.display = matches ? "" : "none";
  });
}

/**
 * È´ò‰∫ÆÊñáÊú¨
 * @param {HTMLElement} element - Ë¶ÅÈ´ò‰∫ÆÁöÑÂÖÉÁ¥†
 * @param {string} searchText - ÊêúÁ¥¢ÊñáÊú¨
 */
function highlightText(element, searchText) {
  if (!element.innerHTML.includes('<span class="highlight">')) {
    const innerHTML = element.innerHTML;
    const index = innerHTML.toLowerCase().indexOf(searchText.toLowerCase());
    if (index >= 0) {
      const highlighted =
        innerHTML.substring(0, index) +
        '<span class="highlight">' +
        innerHTML.substring(index, index + searchText.length) +
        "</span>" +
        innerHTML.substring(index + searchText.length);
      element.innerHTML = highlighted;
    }
  }
}

/**
 * Ê∏ÖÈô§ÊêúÁ¥¢
 */
function clearSearch() {
  document.getElementById("searchInput").value = "";

  // Ê∏ÖÈô§È´ò‰∫Æ
  document.querySelectorAll(".highlight").forEach((el) => {
    const parent = el.parentNode;
    parent.textContent = parent.textContent;
  });

  searchCommits();
  document.getElementById("clearSearch").classList.remove("visible");
}

/**
 * Modal Module Ê®°ÊÄÅÊ°ÜÊ®°Âùó
 * Â§ÑÁêÜÊâÄÊúâÊ®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥ÁöÑÂäüËÉΩ
 */

// IGNORE_REASONS Áî±HTMLÊ®°ÊùøÁöÑÊï∞ÊçÆÊ≥®ÂÖ•ËÑöÊú¨ÂÆö‰πâ

let currentIgnoreHash = null;
let currentIgnoreElement = null;
let currentCommitHash = null;
let currentCommitElement = null;

/**
 * ÊòæÁ§∫ÂøΩÁï•ÂéüÂõ†Ê®°ÊÄÅÊ°Ü
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @param {HTMLElement} element - Ëß¶ÂèëÂÖÉÁ¥†
 */
function showIgnoreModal(hash, element) {
  currentIgnoreHash = hash;
  currentIgnoreElement = element;

  const reasonListElement = document.getElementById("reasonList");
  reasonListElement.innerHTML = "";

  IGNORE_REASONS.forEach((reason, index) => {
    const optionElement = document.createElement("div");
    optionElement.className = "reason-option";

    const radioInput = document.createElement("input");
    radioInput.type = "radio";
    radioInput.id = `reason-${index}`;
    radioInput.name = "ignoreReason";
    radioInput.value = reason;
    if (index === 0) {
      radioInput.checked = true;
      optionElement.classList.add("selected");
    }

    const label = document.createElement("label");
    label.htmlFor = `reason-${index}`;
    label.textContent = reason;

    optionElement.appendChild(radioInput);
    optionElement.appendChild(label);

    optionElement.addEventListener("click", function (e) {
      if (e.target !== radioInput) {
        radioInput.checked = true;

        if (reason === "ÂÖ∂‰ªñÂéüÂõ†") {
          document.getElementById("customReasonInput").classList.add("show");
        } else {
          document.getElementById("customReasonInput").classList.remove("show");
        }

        document.querySelectorAll(".reason-option").forEach((opt) => {
          opt.classList.remove("selected");
        });
        this.classList.add("selected");
      }
    });

    if (reason === "ÂÖ∂‰ªñÂéüÂõ†") {
      radioInput.addEventListener("change", function () {
        document.getElementById("customReasonInput").classList.add("show");
        document.querySelectorAll(".reason-option").forEach((opt) => {
          opt.classList.remove("selected");
        });
        optionElement.classList.add("selected");
      });
    } else {
      radioInput.addEventListener("change", function () {
        document.getElementById("customReasonInput").classList.remove("show");
        document.querySelectorAll(".reason-option").forEach((opt) => {
          opt.classList.remove("selected");
        });
        optionElement.classList.add("selected");
      });
    }

    reasonListElement.appendChild(optionElement);
  });

  document.getElementById("customReasonText").value = "";
  document.getElementById("customReasonInput").classList.remove("show");
  const modal = document.getElementById("ignoreModal");
  modal.style.display = "flex";
  modal.classList.add("show");
}

/**
 * ÂÖ≥Èó≠ÂøΩÁï•ÂéüÂõ†Ê®°ÊÄÅÊ°Ü
 */
function closeIgnoreModal() {
  const modal = document.getElementById("ignoreModal");
  modal.style.display = "none";
  modal.classList.remove("show");
  currentIgnoreHash = null;
  currentIgnoreElement = null;
}

/**
 * Á°ÆËÆ§ÂøΩÁï•
 */
async function confirmIgnore() {
  const selectedReason = document.querySelector(
    'input[name="ignoreReason"]:checked'
  ).value;
  const customReason = document.getElementById("customReasonText").value.trim();
  const finalReason =
    selectedReason === "ÂÖ∂‰ªñÂéüÂõ†" ? customReason : selectedReason;

  if (selectedReason === "ÂÖ∂‰ªñÂéüÂõ†" && !customReason) {
    alert("ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâÁöÑÂøΩÁï•ÂéüÂõ†");
    return;
  }

  showLoading();
  saveCurrentFilterState();

  try {
    const commitElement = currentIgnoreElement.closest(".commit");

    const index = appState.ignoredCommits.findIndex(
      (item) => item.hash === currentIgnoreHash
    );
    if (index === -1) {
      appState.ignoredCommits.push({
        hash: currentIgnoreHash,
        reason: finalReason,
        timestamp: new Date().toISOString(),
      });
    }

    await saveIgnoredCommits(appState.ignoredCommits);

    // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
    appState.ignoredCommits = await loadIgnoredCommits();

    renderCommits();
    closeIgnoreModal();
    showSuccessMessage("ÂøΩÁï•Êèê‰∫§ÊàêÂäü");
  } catch (error) {
    console.error("‰øùÂ≠òÂøΩÁï•Êèê‰∫§Â§±Ë¥•:", error);
    alert("‰øùÂ≠òÂøΩÁï•Êèê‰∫§Â§±Ë¥•: " + error.message);
  } finally {
    hideLoading();
  }
}

/**
 * ÂàáÊç¢ÂøΩÁï•Áä∂ÊÄÅ
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @param {HTMLElement} element - Ëß¶ÂèëÂÖÉÁ¥†
 */
function toggleIgnoreCommit(hash, element) {
  const index = appState.ignoredCommits.findIndex((item) => item.hash === hash);

  if (index === -1) {
    showIgnoreModal(hash, element);
  } else {
    showLoading();
    saveCurrentFilterState();

    appState.ignoredCommits.splice(index, 1);

    saveIgnoredCommits(appState.ignoredCommits)
      .then(() => {
        return loadIgnoredCommits();
      })
      .then((commits) => {
        appState.ignoredCommits = commits;
        renderCommits();
        showSuccessMessage("ÂèñÊ∂àÂøΩÁï•ÊàêÂäü");
      })
      .catch((error) => {
        console.error("‰øùÂ≠òÂøΩÁï•Êèê‰∫§Â§±Ë¥•:", error);
        alert("‰øùÂ≠òÂøΩÁï•Êèê‰∫§Â§±Ë¥•: " + error.message);
      })
      .finally(() => {
        hideLoading();
      });
  }
}

/**
 * ÊòæÁ§∫Â§áÊ≥®Ê®°ÊÄÅÊ°Ü
 * @param {string} hash - Êèê‰∫§ÂìàÂ∏å
 * @param {HTMLElement} element - Ëß¶ÂèëÂÖÉÁ¥†
 */
function showRemarkModal(hash, element) {
  currentCommitHash = hash;
  currentCommitElement = element;

  const remarkText = document.getElementById("remarkText");
  remarkText.value = getRemarkContent(hash);

  const deleteButton = document.getElementById("deleteRemarkBtn");
  if (hasRemark(hash)) {
    deleteButton.style.display = "block";
  } else {
    deleteButton.style.display = "none";
  }

  const modal = document.getElementById("remarkModal");
  modal.style.display = "flex";
  modal.classList.add("show");
}

/**
 * ÂÖ≥Èó≠Â§áÊ≥®Ê®°ÊÄÅÊ°Ü
 */
function closeRemarkModal() {
  const modal = document.getElementById("remarkModal");
  modal.style.display = "none";
  modal.classList.remove("show");
  currentCommitHash = null;
  currentCommitElement = null;
}

/**
 * Á°ÆËÆ§Â§áÊ≥®
 */
async function confirmRemark() {
  const remarkText = document.getElementById("remarkText").value.trim();
  console.log("ÂºÄÂßã‰øùÂ≠òÂ§áÊ≥®ÔºåÂìàÂ∏åÂÄº:", currentCommitHash, "ÂÜÖÂÆπ:", remarkText);

  try {
    showLoading();
    saveCurrentFilterState();

    const existingIndex = appState.commitRemarks.findIndex(
      (r) => r.hash === currentCommitHash
    );

    if (remarkText) {
      if (existingIndex >= 0) {
        appState.commitRemarks[existingIndex].content = remarkText;
        appState.commitRemarks[existingIndex].timestamp =
          new Date().toISOString();
        console.log("Â∑≤Êõ¥Êñ∞Áé∞ÊúâÂ§áÊ≥®");
      } else {
        appState.commitRemarks.push({
          hash: currentCommitHash,
          content: remarkText,
          timestamp: new Date().toISOString(),
        });
        console.log("Â∑≤Ê∑ªÂä†Êñ∞Â§áÊ≥®");
      }
    } else if (existingIndex >= 0) {
      appState.commitRemarks.splice(existingIndex, 1);
      console.log("Â∑≤Âà†Èô§Â§áÊ≥®");
    }

    await saveCommitRemarks(appState.commitRemarks);
    console.log("ÊúçÂä°Âô®‰øùÂ≠òÂ§áÊ≥®ÂÆåÊàê");

    closeRemarkModal();
    renderCommits();
    showSuccessMessage("Â§áÊ≥®Â∑≤‰øùÂ≠ò");
  } catch (error) {
    console.error("‰øùÂ≠òÂ§áÊ≥®Êìç‰ΩúÂ§±Ë¥•:", error);
    alert("‰øùÂ≠òÂ§áÊ≥®Â§±Ë¥•: " + error.message);
  } finally {
    hideLoading();
  }
}

/**
 * Âà†Èô§Â§áÊ≥®
 */
async function deleteRemark() {
  if (!currentCommitHash) return;

  try {
    showLoading();
    saveCurrentFilterState();

    const existingIndex = appState.commitRemarks.findIndex(
      (r) => r.hash === currentCommitHash
    );

    if (existingIndex >= 0) {
      appState.commitRemarks.splice(existingIndex, 1);
      console.log("Â∑≤Âà†Èô§Â§áÊ≥®");

      await saveCommitRemarks(appState.commitRemarks);

      closeRemarkModal();
      renderCommits();
      showSuccessMessage("Â§áÊ≥®Â∑≤Âà†Èô§");
    }
  } catch (error) {
    console.error("Âà†Èô§Â§áÊ≥®Â§±Ë¥•:", error);
    alert("Âà†Èô§Â§áÊ≥®Â§±Ë¥•: " + error.message);
  } finally {
    hideLoading();
  }
}

/**
 * ÊòæÁ§∫Âä†ËΩΩÂä®Áîª
 */
function showLoading() {
  document.getElementById("loadingOverlay").classList.add("show");
}

/**
 * ÈöêËóèÂä†ËΩΩÂä®Áîª
 */
function hideLoading() {
  document.getElementById("loadingOverlay").classList.remove("show");
}

/**
 * ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
 * @param {string} message - Ê∂àÊÅØÂÜÖÂÆπ
 */
function showSuccessMessage(message) {
  const successToast = document.createElement("div");
  successToast.className = "success-toast";
  successToast.textContent = message;
  document.body.appendChild(successToast);

  setTimeout(() => {
    successToast.classList.add("show");
  }, 100);

  setTimeout(() => {
    successToast.classList.remove("show");
    setTimeout(() => successToast.remove(), 500);
  }, 2000);
}

/**
 * Âú®VS Code‰∏≠Êü•ÁúãÊèê‰∫§
 * @param {string} commitHash - Êèê‰∫§ÂìàÂ∏å
 */
function openInVSCode(commitHash) {
  const modal = document.createElement("div");
  modal.style.cssText =
    "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999";

  const content = document.createElement("div");
  content.style.cssText =
    "background:var(--color-bg);padding:var(--spacing-6);border-radius:var(--radius-container);max-width:500px;width:90%;box-shadow:var(--shadow-extruded-hover)";

  const title = document.createElement("h3");
  title.textContent = "Êü•ÁúãÊèê‰∫§ÁöÑGitÂëΩ‰ª§";
  title.style.marginTop = "0";
  title.style.marginBottom = "var(--spacing-4)";

  content.appendChild(title);

  const commands = [
    { name: "Êü•ÁúãÊèê‰∫§ËØ¶ÊÉÖ", command: `git show ${commitHash}` },
    {
      name: "Êü•ÁúãÊèê‰∫§Êõ¥ÊîπÁöÑÊñá‰ª∂",
      command: `git show --name-only ${commitHash}`,
    },
    {
      name: "Êü•ÁúãÊèê‰∫§ÁöÑÂÆåÊï¥Â∑ÆÂºÇ",
      command: `git show --color-words ${commitHash}`,
    },
  ];

  commands.forEach((cmd) => {
    const section = document.createElement("div");
    section.style.marginBottom = "var(--spacing-4)";

    const label = document.createElement("div");
    label.textContent = cmd.name;
    label.style.fontWeight = "var(--font-weight-semibold)";
    label.style.marginBottom = "var(--spacing-2)";

    const commandArea = document.createElement("div");
    commandArea.style.display = "flex";
    commandArea.style.gap = "var(--spacing-2)";

    const cmdText = document.createElement("code");
    cmdText.textContent = cmd.command;
    cmdText.style.cssText =
      "padding:var(--spacing-2);background:rgba(163,177,198,0.1);border-radius:var(--radius-small);font-family:var(--font-mono);flex:1;overflow-x:auto";

    const copyBtn = document.createElement("button");
    copyBtn.textContent = "Â§çÂà∂";
    copyBtn.className = "btn btn-small";
    copyBtn.onclick = () => {
      copyToClipboard(cmd.command, copyBtn);
    };

    commandArea.appendChild(cmdText);
    commandArea.appendChild(copyBtn);

    section.appendChild(label);
    section.appendChild(commandArea);
    content.appendChild(section);
  });

  const closeButton = document.createElement("button");
  closeButton.textContent = "ÂÖ≥Èó≠";
  closeButton.className = "btn";
  closeButton.style.width = "100%";
  closeButton.style.marginTop = "var(--spacing-4)";
  closeButton.onclick = () => document.body.removeChild(modal);

  content.appendChild(closeButton);

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      document.body.removeChild(modal);
    }
  });

  modal.appendChild(content);
  document.body.appendChild(modal);
}

/**
 * Âú®VS Code‰∏≠ÊØîËæÉ‰∏§‰∏™Êèê‰∫§
 * @param {string} sourceHash - Ê∫êÊèê‰∫§ÂìàÂ∏å
 * @param {string} targetHash - ÁõÆÊ†áÊèê‰∫§ÂìàÂ∏å
 */
function compareCommitsInVSCode(sourceHash, targetHash) {
  const modal = document.createElement("div");
  modal.style.cssText =
    "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999";

  const content = document.createElement("div");
  content.style.cssText =
    "background:var(--color-bg);padding:var(--spacing-6);border-radius:var(--radius-container);max-width:500px;width:90%;box-shadow:var(--shadow-extruded-hover)";

  const title = document.createElement("h3");
  title.textContent = "ÊØîËæÉ‰∏§‰∏™Êèê‰∫§ÁöÑGitÂëΩ‰ª§";
  title.style.marginTop = "0";
  title.style.marginBottom = "var(--spacing-4)";

  content.appendChild(title);

  const commands = [
    {
      name: "ÊòæÁ§∫‰∏§‰∏™Êèê‰∫§‰πãÈó¥ÁöÑÂ∑ÆÂºÇ",
      command: `git diff ${sourceHash} ${targetHash}`,
    },
    {
      name: "Êü•ÁúãÊõ¥ÊîπÁöÑÊñá‰ª∂ÂàóË°®",
      command: `git diff --name-only ${sourceHash} ${targetHash}`,
    },
    {
      name: "Êü•ÁúãÊ±áÊÄªÁªüËÆ°‰ø°ÊÅØ",
      command: `git diff --stat ${sourceHash} ${targetHash}`,
    },
  ];

  commands.forEach((cmd) => {
    const section = document.createElement("div");
    section.style.marginBottom = "var(--spacing-4)";

    const label = document.createElement("div");
    label.textContent = cmd.name;
    label.style.fontWeight = "var(--font-weight-semibold)";
    label.style.marginBottom = "var(--spacing-2)";

    const commandArea = document.createElement("div");
    commandArea.style.display = "flex";
    commandArea.style.gap = "var(--spacing-2)";

    const cmdText = document.createElement("code");
    cmdText.textContent = cmd.command;
    cmdText.style.cssText =
      "padding:var(--spacing-2);background:rgba(163,177,198,0.1);border-radius:var(--radius-small);font-family:var(--font-mono);flex:1;overflow-x:auto;white-space:nowrap";

    const copyBtn = document.createElement("button");
    copyBtn.textContent = "Â§çÂà∂";
    copyBtn.className = "btn btn-small";
    copyBtn.onclick = () => {
      copyToClipboard(cmd.command, copyBtn);
    };

    commandArea.appendChild(cmdText);
    commandArea.appendChild(copyBtn);

    section.appendChild(label);
    section.appendChild(commandArea);
    content.appendChild(section);
  });

  const closeButton = document.createElement("button");
  closeButton.textContent = "ÂÖ≥Èó≠";
  closeButton.className = "btn";
  closeButton.style.width = "100%";
  closeButton.style.marginTop = "var(--spacing-4)";
  closeButton.onclick = () => document.body.removeChild(modal);

  content.appendChild(closeButton);

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      document.body.removeChild(modal);
    }
  });

  modal.appendChild(content);
  document.body.appendChild(modal);
}

/**
 * Êü•ÁúãÊèê‰∫§ÂèòÊõ¥
 * @param {string} commitHash - Êèê‰∫§ÂìàÂ∏å
 * @param {string} commitMessage - Êèê‰∫§Ê∂àÊÅØ
 */
function viewCommitChanges(commitHash, commitMessage) {
  console.log("Êü•ÁúãÊèê‰∫§ÂèòÊõ¥:", commitHash, commitMessage);

  const originalBodyStyle = document.body.style.cssText;
  document.body.style.overflow = "hidden";
  document.body.style.paddingRight = "15px";

  const modal = document.createElement("div");
  modal.style.cssText =
    "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999";

  const content = document.createElement("div");
  content.style.cssText =
    "background:#ffffff;padding:var(--spacing-5);border-radius:var(--radius-container);max-width:90%;width:90%;max-height:90vh;display:flex;flex-direction:column;box-shadow:var(--shadow-extruded-hover)";

  const header = document.createElement("div");
  header.style.cssText =
    "display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-3);border-bottom:1px solid rgba(163,177,198,0.2);padding-bottom:var(--spacing-3)";

  const titleArea = document.createElement("div");
  const title = document.createElement("h3");
  title.textContent = "Êèê‰∫§ËØ¶ÊÉÖ";
  title.style.margin = "0 0 var(--spacing-2) 0";

  const subtitle = document.createElement("p");
  subtitle.innerHTML = `<code style="font-family:var(--font-mono);background:rgba(163,177,198,0.15);padding:2px var(--spacing-2);border-radius:var(--radius-small)">${commitHash}</code> - ${escapeHtml(
    commitMessage
  )}`;
  subtitle.style.margin = "0";
  subtitle.style.color = "var(--color-muted)";
  subtitle.style.fontSize = "var(--font-size-sm)";

  titleArea.appendChild(title);
  titleArea.appendChild(subtitle);

  const closeIcon = document.createElement("button");
  closeIcon.innerHTML = "‚úï";
  closeIcon.className = "modal-close-button";
  closeIcon.style.cssText = `
    width: 44px;
    height: 44px;
    min-width: 44px;
    min-height: 44px;
    border-radius: 50%;
    border: none;
    background: var(--color-bg);
    color: var(--color-muted);
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-extruded-small);
    transition: all var(--transition-base);
    flex-shrink: 0;
  `;

  closeIcon.addEventListener("mouseenter", () => {
    closeIcon.style.color = "var(--color-danger)";
    closeIcon.style.transform = "scale(1.05)";
  });

  closeIcon.addEventListener("mouseleave", () => {
    closeIcon.style.color = "var(--color-muted)";
    closeIcon.style.transform = "scale(1)";
  });

  const closeModal = () => {
    document.body.removeChild(modal);
    document.body.style.cssText = originalBodyStyle;
    document.removeEventListener("keydown", handleKeyDown);
  };

  closeIcon.addEventListener("click", closeModal);

  header.appendChild(titleArea);
  header.appendChild(closeIcon);
  content.appendChild(header);

  const diffContainer = document.createElement("div");
  diffContainer.style.cssText =
    "flex:1;overflow:auto;min-height:0;max-height:calc(90vh - 100px);padding-right:var(--spacing-2)";

  const diffViewer = document.createElement("div");
  diffViewer.className = "diff-viewer";
  diffViewer.innerHTML =
    '<div style="padding:var(--spacing-5);text-align:center;color:var(--color-muted)">Ê≠£Âú®Âä†ËΩΩÂèòÊõ¥Êï∞ÊçÆ...</div>';

  diffContainer.appendChild(diffViewer);
  content.appendChild(diffContainer);

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      closeModal();
    }
  });

  const handleKeyDown = (e) => {
    if (e.key === "Escape") {
      closeModal();
    }
  };

  document.addEventListener("keydown", handleKeyDown);

  modal.appendChild(content);
  document.body.appendChild(modal);

  // Ëé∑ÂèñdiffÊï∞ÊçÆ
  fetchGitDiff(commitHash)
    .then((data) => {
      console.log("Ëé∑ÂèñÂà∞diffÊï∞ÊçÆ:", data);
      renderDiffData(data, diffViewer);
    })
    .catch((error) => {
      console.error("Ëé∑ÂèñÊèê‰∫§ÂèòÊõ¥Êï∞ÊçÆÂ§±Ë¥•:", error);
      diffViewer.innerHTML = `
        <div style="padding:var(--spacing-5);text-align:center;color:var(--color-danger);background-color:rgba(220,53,69,0.1);border-radius:var(--radius-base)">
          <p style="margin:0 0 var(--spacing-2) 0;font-weight:var(--font-weight-semibold)">Ëé∑ÂèñÊèê‰∫§ÂèòÊõ¥Êï∞ÊçÆÂ§±Ë¥•</p>
          <p style="margin:0;font-size:var(--font-size-sm)">${escapeHtml(
            error.message
          )}</p>
        </div>
      `;
    });
}

/**
 * ‰ΩøÁî®Diff2HtmlÊ∏≤ÊüìÂ∑ÆÂºÇÊï∞ÊçÆ
 * @param {Object} data - diffÊï∞ÊçÆ
 * @param {HTMLElement} diffViewer - Â∑ÆÂºÇÊü•ÁúãÂô®ÂÖÉÁ¥†
 */
function renderDiffData(data, diffViewer) {
  console.log("Ê∏≤ÊüìÂ∑ÆÂºÇÊï∞ÊçÆ:", data);
  if (!data || !data.diff || data.diff.trim() === "") {
    diffViewer.innerHTML = `
      <div style="padding:var(--spacing-5);text-align:center;color:var(--color-muted);background-color:rgba(163,177,198,0.1);border-radius:var(--radius-base)">
        Ê≠§Êèê‰∫§Ê≤°ÊúâÊñá‰ª∂ÂèòÊõ¥ÊàñÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ
      </div>
    `;
    return;
  }

  const diffText = data.diff;
  diffViewer.innerHTML = "";

  try {
    const ui = new Diff2HtmlUI(diffViewer, diffText, {
      drawFileList: true,
      matching: "lines",
      outputFormat: "side-by-side",
      highlight: true,
    });
    ui.draw();
    ui.highlightCode();

    // Âè™ÈöêËóèË°åÂè∑Ôºå‰∏çÊ∑ªÂä†‰ªª‰ΩïÂÖ∂‰ªñÊ†∑Âºè
    const style = document.createElement("style");
    style.textContent = `
      /* ÈöêËóèÊâÄÊúâË°åÂè∑ */
      .d2h-code-line-prefix,
      .d2h-code-linenumber,
      .d2h-code-side-linenumber,
      .d2h-line-num1,
      .d2h-line-num2,
      .line-num1,
      .line-num2 {
        display: none !important;
      }
    `;
    diffViewer.appendChild(style);
  } catch (e) {
    console.error("Diff2Html Ê∏≤ÊüìÂ§±Ë¥•:", e);
    diffViewer.innerHTML = `
      <div style="padding:var(--spacing-5);text-align:center;color:var(--color-danger);background-color:rgba(220,53,69,0.1);border-radius:var(--radius-base)">
        Êó†Ê≥ïÊ∏≤ÊüìÂ∑ÆÂºÇËßÜÂõæÔºö${escapeHtml(e.message)}
      </div>
    `;
  }
}

// ‰∏ªÂÖ•Âè£Êñá‰ª∂ - ÂàùÂßãÂåñÂ∫îÁî®Âíå‰∫ã‰ª∂ÁªëÂÆö

/**
 * ÂàùÂßãÂåñÂ∫îÁî®
 */
async function initApp() {
  console.log("ÂàùÂßãÂåñÂ∫îÁî®...");

  // ÂàùÂßãÂåñappState‰∏≠ÁöÑÊï∞ÊçÆÔºà‰ªéHTMLÊ®°ÊùøÊ≥®ÂÖ•ÁöÑÂÖ®Â±ÄÂèòÈáèÔºâ
  appState.commits = commits || [];
  appState.sourceBranch = sourceBranch || "";
  appState.targetBranch = targetBranch || "";
  appState.ignoredCommits = ignoredCommits || [];
  appState.commitRemarks = commitRemarks || [];

  console.log("Â∑≤Âä†ËΩΩÊèê‰∫§Êï∞ÊçÆ:", appState.commits.length, "Êù°");
  console.log("Â∑≤Âä†ËΩΩÂøΩÁï•Êèê‰∫§:", appState.ignoredCommits.length, "Êù°");
  console.log("Â∑≤Âä†ËΩΩÂ§áÊ≥®:", appState.commitRemarks.length, "Êù°");

  // ‰ªéÊúçÂä°Âô®Âä†ËΩΩÊúÄÊñ∞ÁöÑÂ∑≤ÂøΩÁï•Êèê‰∫§ÂíåÂ§áÊ≥®Êï∞ÊçÆ
  try {
    const [loadedIgnored, loadedRemarks] = await Promise.all([
      loadIgnoredCommits(),
      loadCommitRemarks(),
    ]);

    appState.ignoredCommits = loadedIgnored;
    appState.commitRemarks = loadedRemarks;

    console.log("‰ªéÊúçÂä°Âô®Êõ¥Êñ∞ÂøΩÁï•Êèê‰∫§:", appState.ignoredCommits.length, "Êù°");
    console.log("‰ªéÊúçÂä°Âô®Êõ¥Êñ∞Â§áÊ≥®:", appState.commitRemarks.length, "Êù°");
  } catch (error) {
    console.error("Âä†ËΩΩÊúçÂä°Âô®Êï∞ÊçÆÂ§±Ë¥•:", error);
  }

  // Ê∏≤ÊüìÊèê‰∫§ÂàóË°®
  renderCommits(false);

  // ÂàùÂßãÂåñÂ∏ÉÂ±Ä
  initializeLayout();

  // ÂàùÂßãÂåñÁ≠õÈÄâÁä∂ÊÄÅ
  initializeFilterState();

  // ËÆæÁΩÆÂàùÂßãÂ≠êÁ≠õÈÄâÂô®ÂèØËßÅÊÄß
  const initialFilter =
    document.body.getAttribute("data-current-filter") || "all";
  const subFilterSection = document.getElementById("subFilterSection");
  if (initialFilter !== "all") {
    subFilterSection.classList.add("hidden");
  }

  console.log("Â∫îÁî®ÂàùÂßãÂåñÂÆåÊàê");
}

/**
 * ÁªëÂÆöÂÖ®Â±Ä‰∫ã‰ª∂Ôºà‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÔºâ
 */
function bindEvents() {
  // ÂÖ®Â±ÄÁÇπÂáª‰∫ã‰ª∂ÂßîÊâò
  document.addEventListener("click", handleGlobalClick);

  // ÂÖ®Â±ÄËæìÂÖ•‰∫ã‰ª∂ÂßîÊâò
  document.addEventListener("input", handleGlobalInput);

  // ÂÖ®Â±Ächange‰∫ã‰ª∂ÂßîÊâò
  document.addEventListener("change", handleGlobalChange);

  // ÊªöÂä®‰∫ã‰ª∂
  window.addEventListener("scroll", handleScroll);

  // ÊµèËßàÂô®ÂâçËøõÂêéÈÄÄ‰∫ã‰ª∂
  window.addEventListener("popstate", handlePopState);
}

/**
 * Â§ÑÁêÜÂÖ®Â±ÄÁÇπÂáª‰∫ã‰ª∂
 */
function handleGlobalClick(event) {
  const target = event.target;

  // Â§ÑÁêÜÁ≠õÈÄâÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("filter-button")) {
    const filterType = target.getAttribute("data-filter");
    if (filterType) {
      filterCommits(filterType);
    }
    return;
  }

  // Â§ÑÁêÜÂøΩÁï•ÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("ignore-button")) {
    const commitElement = target.closest(".commit");
    const hash = commitElement.getAttribute("data-hash");
    toggleIgnoreCommit(hash, target);
    return;
  }

  // Â§ÑÁêÜÂ§áÊ≥®ÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("remark-button")) {
    const commitElement = target.closest(".commit");
    const hash = commitElement.getAttribute("data-hash");
    showRemarkModal(hash, target);
    return;
  }

  // Â§ÑÁêÜÊèê‰∫§Ê∂àÊÅØÂ§çÂà∂
  if (target.classList.contains("commit-message")) {
    copyToClipboard(target.textContent, target);
    return;
  }

  // Â§ÑÁêÜÊèê‰∫§ÂìàÂ∏åÂ§çÂà∂
  if (target.classList.contains("commit-hash")) {
    const fullHash = target.getAttribute("title") || target.textContent;
    copyToClipboard(fullHash, target);
    return;
  }

  // Â§ÑÁêÜVS CodeÊåâÈíÆÁÇπÂáª
  if (
    target.classList.contains("vscode-button") ||
    target.closest(".vscode-button")
  ) {
    const button = target.classList.contains("vscode-button")
      ? target
      : target.closest(".vscode-button");
    const commitElement = button.closest(".commit");
    if (commitElement) {
      const hash = commitElement.getAttribute("data-hash");
      openInVSCode(hash);
    }
    event.stopPropagation();
    return;
  }

  // Â§ÑÁêÜÊü•ÁúãÂèòÊõ¥ÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("view-changes-btn")) {
    const commitElement = target.closest(".commit");
    if (commitElement) {
      const hash = commitElement.getAttribute("data-hash");
      const status = commitElement.getAttribute("data-status");
      viewCommitChanges(hash, status);
    }
    event.stopPropagation();
    return;
  }

  // Â§ÑÁêÜÊØîËæÉÊèê‰∫§ÊåâÈíÆÁÇπÂáª
  if (
    target.classList.contains("compare-in-vscode") ||
    target.closest(".compare-in-vscode")
  ) {
    const button = target.classList.contains("compare-in-vscode")
      ? target
      : target.closest(".compare-in-vscode");
    const commitElement = button.closest(".commit");
    if (commitElement) {
      const hash = commitElement.getAttribute("data-hash");
      // ‰ªécommit-hash-pair‰∏≠ÊâæÂà∞‰∏§‰∏™hash
      const hashPair = button.closest(".commit-hash-pair");
      if (hashPair) {
        const hashBranches = hashPair.querySelectorAll(".commit-hash");
        if (hashBranches.length >= 2) {
          const hash1 = hashBranches[0].getAttribute("title");
          const hash2 = hashBranches[1].getAttribute("title");
          compareCommitsInVSCode(hash1, hash2);
        }
      }
    }
    event.stopPropagation();
    return;
  }

  // Â§ÑÁêÜÂëΩ‰ª§Ê†áÁ≠æÂàáÊç¢
  if (target.classList.contains("command-tab")) {
    const tab = target.getAttribute("data-command");
    switchCommandTab(tab);
    return;
  }

  // Â§ÑÁêÜÂ§çÂà∂ÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("copy-button")) {
    // Ê£ÄÊü•ÊòØÂì™‰∏™Â§çÂà∂ÊåâÈíÆ
    if (target.classList.contains("copy-source-to-target-button")) {
      copyCommandBlock("source-to-target");
    } else if (target.classList.contains("copy-target-to-source-button")) {
      copyCommandBlock("target-to-source");
    }
    return;
  }

  // Â§ÑÁêÜÂçïË°åÂ§çÂà∂ÊåâÈíÆÁÇπÂáª
  if (target.classList.contains("copy-line-button")) {
    const cmdText = target.previousElementSibling.textContent;
    copyToClipboard(cmdText, target);
    return;
  }

  // Â§ÑÁêÜÊ∏ÖÈô§ÊêúÁ¥¢ÊåâÈíÆÁÇπÂáª
  if (target.id === "clearSearch") {
    clearSearch();
    return;
  }

  // Â§ÑÁêÜËøîÂõûÈ°∂ÈÉ®ÊåâÈíÆÁÇπÂáª
  if (target.id === "backToTop") {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
    return;
  }

  // Â§ÑÁêÜÂ∏ÉÂ±ÄÂàáÊç¢ÊåâÈíÆ
  if (target.id === "chatLayoutBtn" || target.closest("#chatLayoutBtn")) {
    switchLayout("chat");
    return;
  }

  if (target.id === "flatLayoutBtn" || target.closest("#flatLayoutBtn")) {
    switchLayout("flat");
    return;
  }

  // Â§ÑÁêÜÊ®°ÊÄÅÊ°ÜÂÖ≥Èó≠
  if (target.id === "ignoreModal" || target.classList.contains("modal")) {
    if (target === event.target) {
      closeIgnoreModal();
    }
    return;
  }

  if (
    target.id === "remarkModal" ||
    target.classList.contains("remark-modal")
  ) {
    if (target === event.target) {
      closeRemarkModal();
    }
    return;
  }

  // Â§ÑÁêÜÊ®°ÊÄÅÊ°ÜÊåâÈíÆ
  if (target.classList.contains("modal-button")) {
    if (target.classList.contains("confirm")) {
      confirmIgnore();
    } else if (target.classList.contains("cancel")) {
      closeIgnoreModal();
    }
    return;
  }

  if (target.classList.contains("remark-modal-button")) {
    if (target.classList.contains("remark-save")) {
      confirmRemark();
    } else if (target.classList.contains("remark-cancel")) {
      closeRemarkModal();
    } else if (target.classList.contains("remark-delete")) {
      deleteRemark();
    }
    return;
  }

  // Â§ÑÁêÜÂøΩÁï•ÂéüÂõ†ÈÄâÈ°πÁÇπÂáª
  if (
    target.classList.contains("reason-option") ||
    target.closest(".reason-option")
  ) {
    const option = target.classList.contains("reason-option")
      ? target
      : target.closest(".reason-option");
    const radio = option.querySelector('input[type="radio"]');
    if (radio && event.target !== radio) {
      radio.checked = true;

      // Â§ÑÁêÜËá™ÂÆö‰πâÂéüÂõ†ËæìÂÖ•Ê°ÜÊòæÁ§∫ÈÄªËæë
      const customReasonInput = document.getElementById("customReasonInput");
      if (radio.value === "ÂÖ∂‰ªñÂéüÂõ†") {
        customReasonInput.classList.add("show");
      } else {
        customReasonInput.classList.remove("show");
      }

      // Êõ¥Êñ∞ÈÄâ‰∏≠Ê†∑Âºè
      document.querySelectorAll(".reason-option").forEach((opt) => {
        opt.classList.remove("selected");
      });
      option.classList.add("selected");
    }
    return;
  }
}

/**
 * Â§ÑÁêÜÂÖ®Â±ÄËæìÂÖ•‰∫ã‰ª∂
 */
function handleGlobalInput(event) {
  const target = event.target;

  // Â§ÑÁêÜÊêúÁ¥¢ËæìÂÖ•
  if (target.id === "searchInput") {
    searchCommits();
    return;
  }
}

/**
 * Â§ÑÁêÜÂÖ®Â±Ächange‰∫ã‰ª∂
 */
function handleGlobalChange(event) {
  const target = event.target;

  // Â§ÑÁêÜÂ≠êÁ≠õÈÄâÂô®Â§çÈÄâÊ°ÜÂèòÂåñ
  if (target.id === "hideIgnoredCommits" || target.id === "hideCommonCommits") {
    applySubFilters();
    return;
  }

  // Â§ÑÁêÜÊêúÁ¥¢ÈÄâÈ°πÂ§çÈÄâÊ°ÜÂèòÂåñ
  if (
    target.id === "searchMessage" ||
    target.id === "searchAuthor" ||
    target.id === "searchHash"
  ) {
    searchCommits();
    return;
  }

  // Â§ÑÁêÜÂøΩÁï•ÂéüÂõ†ÂçïÈÄâÊåâÈíÆÂèòÂåñ
  if (target.name === "ignoreReason") {
    const customReasonInput = document.getElementById("customReasonInput");
    if (target.value === "ÂÖ∂‰ªñÂéüÂõ†") {
      customReasonInput.classList.add("show");
    } else {
      customReasonInput.classList.remove("show");
    }

    // Êõ¥Êñ∞ÈÄâ‰∏≠Ê†∑Âºè
    document.querySelectorAll(".reason-option").forEach((opt) => {
      opt.classList.remove("selected");
    });
    target.closest(".reason-option").classList.add("selected");
    return;
  }
}

/**
 * Â§ÑÁêÜÊªöÂä®‰∫ã‰ª∂
 */
function handleScroll() {
  const backToTopButton = document.getElementById("backToTop");
  if (backToTopButton) {
    if (window.scrollY > 300) {
      backToTopButton.classList.add("show");
    } else {
      backToTopButton.classList.remove("show");
    }
  }
}

/**
 * Â§ÑÁêÜÊµèËßàÂô®ÂâçËøõÂêéÈÄÄ‰∫ã‰ª∂
 */
function handlePopState() {
  // ‰ªéURLÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅ
  initializeFilterState();
}

/**
 * ÂàùÂßãÂåñÂ∏ÉÂ±Ä
 */
function initializeLayout() {
  const savedLayout = localStorage.getItem("preferredLayout") || "flat";
  switchLayout(savedLayout);
}

/**
 * ÂàáÊç¢Â∏ÉÂ±Ä
 */
function switchLayout(layout) {
  // Êõ¥Êñ∞Â∏ÉÂ±ÄÊåâÈíÆ
  document
    .getElementById("chatLayoutBtn")
    .classList.toggle("active", layout === "chat");
  document
    .getElementById("flatLayoutBtn")
    .classList.toggle("active", layout === "flat");

  // Êõ¥Êñ∞Êó∂Èó¥ËΩ¥Á±ª
  const timeline = document.getElementById("timeline");
  if (layout === "flat") {
    timeline.classList.add("flat-layout");
  } else {
    timeline.classList.remove("flat-layout");
  }

  // Â≠òÂÇ®ÂΩìÂâçÂ∏ÉÂ±Ä
  document.body.setAttribute("data-layout", layout);

  // ÈáçÊñ∞Ê∏≤ÊüìÊèê‰∫§
  renderCommits();

  // ‰øùÂ≠òÂÅèÂ•ΩÂà∞localStorage
  localStorage.setItem("preferredLayout", layout);
}

/**
 * ÂàáÊç¢ÂëΩ‰ª§Ê†áÁ≠æ
 */
function switchCommandTab(tab) {
  document.querySelectorAll(".command-tab").forEach((item) => {
    item.classList.toggle("active", item.getAttribute("data-command") === tab);
  });
  document.querySelectorAll(".command-content").forEach((item) => {
    item.classList.toggle("active", item.id === `${tab}-content`);
  });
}

// È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
document.addEventListener("DOMContentLoaded", () => {
  // Ê£ÄÊü•URLÊòØÂê¶ÊúâÂèÇÊï∞
  const urlParams = new URLSearchParams(window.location.search);
  if (
    !urlParams.has("filter") &&
    !urlParams.has("hideIgnored") &&
    !urlParams.has("hideCommon")
  ) {
    // ËÆæÁΩÆÈªòËÆ§URLÂèÇÊï∞
    const url = new URL(window.location.href);
    url.searchParams.set("filter", "all");
    url.searchParams.set("hideIgnored", "0");
    url.searchParams.set("hideCommon", "1");
    window.history.replaceState({}, "", url.toString());
  }

  // ËÆæÁΩÆÂàùÂßãÁ≠õÈÄâÁä∂ÊÄÅË∑üË∏™
  saveCurrentFilterState();

  // ÁªëÂÆö‰∫ã‰ª∂
  bindEvents();

  // ÂàùÂßãÂåñÂ∫îÁî®
  initApp();
});


    </script>
  </body>
</html>
