<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
    <style>
      {{inlinedCSS}}
    </style>
  </head>
  <body data-layout="chat">
    <!-- æ·»åŠ å¿½ç•¥åŸå› é€‰æ‹©å¼¹çª— -->
    <div id="ignoreModal" class="modal">
      <div class="modal-content">
        <h3>é€‰æ‹©å¿½ç•¥åŸå› </h3>
        <div class="reason-list" id="reasonList">
          <!-- åŸå› é€‰é¡¹å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
        </div>
        <div id="customReasonInput" class="custom-reason">
          <input
            type="text"
            placeholder="è¯·è¾“å…¥å¿½ç•¥åŸå› "
            id="customReasonText"
          />
        </div>
        <div class="modal-buttons">
          <button class="modal-button cancel">å–æ¶ˆ</button>
          <button class="modal-button confirm">ç¡®è®¤</button>
        </div>
      </div>
    </div>

    <!-- æ·»åŠ å¤‡æ³¨å¼¹çª— -->
    <div id="remarkModal" class="remark-modal">
      <div class="remark-modal-content">
        <h3>ç¼–è¾‘å¤‡æ³¨</h3>
        <textarea
          id="remarkText"
          class="remark-textarea"
          placeholder="è¯·è¾“å…¥å¤‡æ³¨å†…å®¹..."
        ></textarea>
        <div class="remark-modal-buttons">
          <button
            class="remark-modal-button remark-delete"
            id="deleteRemarkBtn"
          >
            åˆ é™¤å¤‡æ³¨
          </button>
          <button class="remark-modal-button remark-cancel">å–æ¶ˆ</button>
          <button class="remark-modal-button remark-save">ä¿å­˜</button>
        </div>
      </div>
    </div>

    <!-- æ·»åŠ loadingè¦†ç›–å±‚ -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- æ·»åŠ è¿”å›é¡¶éƒ¨æŒ‰é’® -->
    <div id="backToTop" class="back-to-top">â†‘</div>

    <div class="container">
      <div class="header">
        <div>
          <h1>åˆ†æ”¯æäº¤å¯¹æ¯”</h1>
          <div class="meta-info">
            <div>ç”Ÿæˆæ—¶é—´: {{generatedTime}}</div>
            <div id="authorInfo" style="display: none">æäº¤è€…: {{author}}</div>
            <div id="timeRangeInfo" style="display: none">
              æ—¶é—´èŒƒå›´: {{timeRange}}
            </div>
          </div>
        </div>
        <div class="timeline-legend">
          <div class="legend-item">
            <span class="legend-dot source"></span> {{sourceBranch}} (åŸºå‡†åˆ†æ”¯)
          </div>
          <div class="legend-item">
            <span class="legend-dot target"></span> {{targetBranch}}
          </div>
          <div class="legend-item">
            <span
              class="legend-dot both"
              style="background-color: #1890ff"
            ></span>
            æ¶ˆæ¯ç›¸åŒçš„å…±åŒæäº¤
          </div>
        </div>

        <div class="theme-switcher">
          <button id="chatLayoutBtn" class="theme-button active">
            <span>èŠå¤©å¸ƒå±€</span>
            <span class="layout-icon">ğŸ’¬</span>
          </button>
          <button id="flatLayoutBtn" class="theme-button">
            <span>åˆ—è¡¨å¸ƒå±€</span>
            <span class="layout-icon">ğŸ“‘</span>
          </button>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-buttons">
          <button class="filter-button active" data-filter="all">
            å…¨éƒ¨æäº¤
          </button>
          <button class="filter-button" data-filter="source">
            ä»…{{sourceBranch}}åˆ†æ”¯
          </button>
          <button class="filter-button" data-filter="target">
            ä»…{{targetBranch}}åˆ†æ”¯
          </button>
          <button class="filter-button" data-filter="common">å…±åŒæäº¤</button>
          <button class="filter-button" data-filter="ignored">
            å·²å¿½ç•¥æäº¤
          </button>
        </div>

        <div class="sub-filter-section" id="subFilterSection">
          <label class="filter-checkbox">
            <input type="checkbox" id="hideIgnoredCommits" />
            <span>éšè—å·²å¿½ç•¥æäº¤</span>
          </label>
          <label class="filter-checkbox">
            <input type="checkbox" id="hideCommonCommits" />
            <span>éšè—å…±åŒæäº¤</span>
          </label>
        </div>

        <div class="search-section">
          <div class="search-container">
            <input
              type="text"
              class="search-input"
              id="searchInput"
              placeholder="æœç´¢æäº¤ä¿¡æ¯ã€ä½œè€…æˆ–å“ˆå¸Œ..."
            />
            <button class="clear-search" id="clearSearch">âœ•</button>
            <div class="search-options">
              <label class="search-checkbox">
                <input type="checkbox" id="searchMessage" checked />
                <span>æäº¤ä¿¡æ¯</span>
              </label>
              <label class="search-checkbox">
                <input type="checkbox" id="searchAuthor" checked />
                <span>ä½œè€…</span>
              </label>
              <label class="search-checkbox">
                <input type="checkbox" id="searchHash" />
                <span>å“ˆå¸Œ</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="timeline" id="timeline"></div>

      <div class="command-section">
        <div class="command-tabs">
          <button class="command-tab active" data-command="source-to-target">
            <span class="branch-badge source">
              <svg
                class="branch-icon"
                viewBox="0 0 16 16"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"
                />
              </svg>
              {{sourceBranch}}
            </span>
            <svg
              class="arrow-icon"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M5 12H19M19 12L12 5M19 12L12 19"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <span class="branch-badge target">
              <svg
                class="branch-icon"
                viewBox="0 0 16 16"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"
                />
              </svg>
              {{targetBranch}}
            </span>
          </button>
          <button class="command-tab" data-command="target-to-source">
            <span class="branch-badge target">
              <svg
                class="branch-icon"
                viewBox="0 0 16 16"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"
                />
              </svg>
              {{targetBranch}}
            </span>
            <svg
              class="arrow-icon"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M5 12H19M19 12L12 5M19 12L12 19"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <span class="branch-badge source">
              <svg
                class="branch-icon"
                viewBox="0 0 16 16"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"
                />
              </svg>
              {{sourceBranch}}
            </span>
          </button>
        </div>

        <div id="source-to-target-content" class="command-content active">
          <h3>
            Cherry-pick æŒ‡ä»¤ ({{sourceBranch}} â†’ {{targetBranch}})
            <button class="copy-button copy-source-to-target-button">
              å¤åˆ¶å…¨éƒ¨
            </button>
          </h3>
          <div id="source-to-target-commands-container"></div>
          <pre
            style="display: none"
          ><code id="source-to-target-commands"></code></pre>
        </div>

        <div id="target-to-source-content" class="command-content">
          <h3>
            Cherry-pick æŒ‡ä»¤ ({{targetBranch}} â†’ {{sourceBranch}})
            <button class="copy-button copy-target-to-source-button">
              å¤åˆ¶å…¨éƒ¨
            </button>
          </h3>
          <div id="target-to-source-commands-container"></div>
          <pre
            style="display: none"
          ><code id="target-to-source-commands"></code></pre>
        </div>
      </div>
    </div>

    <script>
      // å…¨å±€é…ç½®å’Œæ•°æ®æ³¨å…¥
      const PORT = '{{port}}';
      const API_BASE = `http://localhost:${PORT}`;

      // ä»æ¨¡æ¿æ³¨å…¥çš„æ•°æ®
      const commits = {{commits}};
      const sourceBranch = {{sourceBranch}};
      const targetBranch = {{targetBranch}};
      let ignoredCommits = {{ignoredCommits}} || [];
      let commitRemarks = {{commitRemarks}} || [];
      const author = {{author}};
      const timeRange = {{timeRange}};

      // å¿½ç•¥åŸå› é€‰é¡¹
      const IGNORE_REASONS = [
        'å·²æ‰‹åŠ¨åˆå¹¶',
        'ä¸éœ€è¦åˆå¹¶',
        'å­˜åœ¨å†²çª',
        'å¾…è¿›ä¸€æ­¥ç¡®è®¤',
        'å…¶ä»–åŸå› '
      ];
    </script>

    <script>
      {{inlinedJS}}
    </script>
  </body>
</html>
